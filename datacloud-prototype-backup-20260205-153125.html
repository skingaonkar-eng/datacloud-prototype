<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Cloud - Segment Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #f3f4f6;
            color: #1f2937;
            overflow-x: hidden;
        }

        /* Header */
        .app-header {
            background: #0B3A5D;
            color: white;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: background 0.2s;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .segment-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .datacloud-icon {
            width: 20px;
            height: 20px;
        }

        .segment-icon {
            width: 24px;
            height: 24px;
        }

        .segment-name {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-icons {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .header-icon-btn svg {
            width: 20px;
            height: 20px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .audience-count {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }

        .count-number {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .count-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .count-percentage {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.375rem;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }

        .btn-secondary {
            background: white;
            color: #0B3A5D;
        }

        .btn-secondary:hover {
            background: #f9fafb;
        }

        .btn-primary {
            background: #1d72f3;
            color: white;
        }

        .btn-primary:hover {
            background: #1557c7;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 1.5rem;
            display: flex;
            gap: 0.5rem;
        }

        .tab-item {
            padding: 1rem 1.5rem;
            font-size: 0.9375rem;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            background: none;
            border-top: none;
            border-left: none;
            border-right: none;
        }

        .tab-item:hover {
            color: #1f2937;
            background: #f9fafb;
        }

        .tab-item.active {
            color: #1d72f3;
            border-bottom-color: #1d72f3;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        /* Welcome State - Agentic Layout */
        .welcome-state {
            min-height: calc(100vh - 60px);
            display: flex;
            flex-direction: column;
            padding: 2rem;
            overflow-y: auto;
        }

        .agent-main {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 1rem;
            padding: 2.5rem 3rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            margin-bottom: 2rem;
        }

        .agent-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .agent-avatar {
            width: 72px;
            height: 72px;
            background: linear-gradient(135deg, #1d72f3 0%, #1557b0 100%);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            box-shadow: 0 6px 16px rgba(29, 114, 243, 0.25);
        }

        .welcome-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            color: #1d72f3;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.0625rem;
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .goal-suggestions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.875rem;
            margin-bottom: 1.25rem;
        }

        .goal-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.625rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .goal-card:hover {
            border-color: #1d72f3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(29, 114, 243, 0.15);
        }

        .goal-card-icon {
            width: 36px;
            height: 36px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0.625rem;
        }

        .goal-card-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.375rem;
        }

        .goal-card-description {
            font-size: 0.8125rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .divider-or {
            text-align: center;
            margin: 1.5rem 0;
            position: relative;
        }

        .divider-or::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 1px;
            background: #e5e7eb;
        }

        .divider-or span {
            position: relative;
            background: white;
            padding: 0 1rem;
            font-size: 0.8125rem;
            color: #9ca3af;
            font-weight: 500;
        }

        .goal-input-container {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .goal-input-container:focus-within {
            border-color: #1d72f3;
        }

        .goal-input {
            flex: 1;
            padding: 0.875rem 1.125rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.625rem;
            outline: none;
            font-size: 0.9375rem;
            transition: all 0.2s;
        }

        .goal-input:focus {
            border-color: #1d72f3;
            box-shadow: 0 0 0 3px rgba(29, 114, 243, 0.1);
        }

        .goal-submit {
            padding: 0.875rem 1.75rem;
            background: #1d72f3;
            color: white;
            border: none;
            border-radius: 0.625rem;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .goal-submit:hover {
            background: #1557b0;
        }

        /* Conversation-style Follow-up */
        .followup-container {
            display: none;
            animation: fadeIn 0.3s ease-out;
            margin-top: 2rem;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            padding-right: 1rem;
        }

        .followup-container::-webkit-scrollbar {
            width: 8px;
        }

        .followup-container::-webkit-scrollbar-track {
            background: #f3f4f6;
            border-radius: 4px;
        }

        .followup-container::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }

        .followup-container::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        .chat-message {
            display: flex;
            gap: 0.875rem;
            margin-bottom: 1.5rem;
            animation: slideIn 0.4s ease-out;
        }

        .chat-message.user-message {
            justify-content: flex-end;
        }

        .chat-message.user-message .chat-bubble {
            background: #eff6ff;
            border-color: #1d72f3;
            margin-left: auto;
            max-width: 70%;
        }

        .chat-message.user-message .chat-bubble-text {
            color: #1d72f3;
            font-weight: 500;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #1d72f3 0%, #1557b0 100%);
            border-radius: 0.625rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(29, 114, 243, 0.2);
        }

        .chat-bubble {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.875rem;
            padding: 1.25rem 1.5rem;
            flex: 1;
        }

        .chat-bubble-text {
            font-size: 1rem;
            color: #1f2937;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .chat-options {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .chat-option {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 0.625rem;
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.9375rem;
            color: #374151;
            font-weight: 500;
            white-space: nowrap;
            flex: 0 0 auto;
        }

        .chat-option:hover {
            border-color: #1d72f3;
            background: #eff6ff;
        }

        .chat-option.selected {
            border-color: #1d72f3;
            background: #eff6ff;
            color: #1d72f3;
            font-weight: 600;
        }

        .proceed-btn {
            width: 100%;
            padding: 1rem;
            background: #1d72f3;
            color: white;
            border: none;
            border-radius: 0.625rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 1.5rem;
        }

        .proceed-btn:hover:not(:disabled) {
            background: #1557b0;
        }

        .proceed-btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
        }

        /* Strategy Selection Cards */
        .strategies-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
            margin-top: 1.5rem;
        }

        .strategy-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1rem;
            padding: 1.75rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .strategy-card:hover {
            border-color: #1d72f3;
            background: #eff6ff;
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(29, 114, 243, 0.15);
        }

        .strategy-icon {
            font-size: 2.5rem;
            margin-bottom: 0.875rem;
        }

        .strategy-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.75rem;
        }

        .strategy-description {
            font-size: 0.9375rem;
            color: #374151;
            font-weight: 500;
            margin-bottom: 0.625rem;
            line-height: 1.5;
        }

        .strategy-details {
            font-size: 0.875rem;
            color: #6b7280;
            font-style: italic;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Global Agentic Command Bar */
        .global-agent-bar {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: none; /* Hidden on landing page */
            animation: slideUpFade 0.4s ease-out;
        }

        .global-agent-bar.active {
            display: block;
        }

        .agent-command-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid #e5e7eb;
            border-radius: 2rem;
            padding: 0.75rem 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 600px;
            max-width: 700px;
            transition: all 0.3s ease;
        }

        .agent-command-container:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.16);
            border-color: #1d72f3;
        }

        .agent-bar-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #1d72f3 0%, #1557b0 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .agent-command-input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 0.9375rem;
            color: #1f2937;
            outline: none;
            font-weight: 500;
        }

        .agent-command-input::placeholder {
            color: #9ca3af;
        }

        .agent-status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.375rem 0.75rem;
            background: rgba(29, 114, 243, 0.08);
            border-radius: 1rem;
            font-size: 0.8125rem;
            color: #1d72f3;
            font-weight: 600;
        }

        .sparkle-icon {
            width: 16px;
            height: 16px;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translate(-50%, 20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        /* Action Feedback Animation */
        @keyframes highlightPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(29, 114, 243, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(29, 114, 243, 0);
            }
        }

        .action-highlight {
            animation: highlightPulse 0.6s ease-out;
        }

        /* Agent Chat Expansion (expands from bottom bar) */
        .agent-chat-expansion {
            position: fixed;
            bottom: 6rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 998;
            display: none;
            width: 700px;
            max-width: calc(100vw - 4rem);
        }

        .agent-chat-expansion.show {
            display: block;
            animation: expandUp 0.3s ease-out;
        }

        .agent-chat-expansion.collapsed {
            display: none;
        }

        .agent-chat-container {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(229, 231, 235, 0.6);
            border-radius: 1.5rem 1.5rem 0 0;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .agent-chat-header-bar {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            padding: 0.625rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(229, 231, 235, 0.3);
        }

        .agent-chat-header-left {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }

        .agent-typing-indicator {
            display: none;
            align-items: center;
            gap: 0.375rem;
        }

        .agent-typing-indicator.active {
            display: flex;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #1d72f3;
            border-radius: 50%;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }

        .agent-chat-collapse-icon {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 0.25rem;
            display: flex;
            align-items: center;
            transition: all 0.2s;
            border-radius: 0.25rem;
        }

        .agent-chat-collapse-icon:hover {
            color: #6b7280;
            background: rgba(156, 163, 175, 0.1);
        }

        .agent-chat-messages-container {
            padding: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.125rem;
        }

        .agent-chat-messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .agent-chat-messages-container::-webkit-scrollbar-track {
            background: rgba(243, 244, 246, 0.3);
            border-radius: 3px;
        }

        .agent-chat-messages-container::-webkit-scrollbar-thumb {
            background: rgba(156, 163, 175, 0.4);
            border-radius: 3px;
        }

        .agent-chat-message {
            display: flex;
            gap: 0.875rem;
            animation: slideIn 0.3s ease-out;
        }

        .agent-chat-message.user-msg {
            flex-direction: row-reverse;
        }

        .agent-msg-avatar {
            width: 36px;
            height: 36px;
            border-radius: 0.625rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .agent-msg-avatar.agent {
            background: linear-gradient(135deg, #1d72f3 0%, #1557b0 100%);
            box-shadow: 0 2px 8px rgba(29, 114, 243, 0.3);
        }

        .agent-msg-avatar.user {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
            color: #6b7280;
        }

        .agent-msg-bubble {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(229, 231, 235, 0.5);
            border-radius: 1rem;
            padding: 0.875rem 1.25rem;
            max-width: 480px;
            font-size: 0.9375rem;
            color: #1f2937;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .agent-chat-message.user-msg .agent-msg-bubble {
            background: rgba(239, 246, 255, 0.95);
            border-color: rgba(191, 219, 254, 0.6);
            color: #1e40af;
        }

        .agent-msg-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.625rem;
        }

        .agent-suggestion-chip {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(29, 114, 243, 0.3);
            border-radius: 1rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            color: #1d72f3;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .agent-suggestion-chip:hover {
            background: rgba(29, 114, 243, 0.1);
            border-color: #1d72f3;
            transform: translateY(-1px);
        }

        @keyframes expandUp {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }


        /* Stats Bottom Bar */
        .stats-sidebar {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .stat-mini {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
        }

        .stat-mini-icon {
            width: 32px;
            height: 32px;
            border-radius: 0.375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
        }

        .stat-mini-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .stat-mini-label {
            font-size: 0.75rem;
            color: #6b7280;
        }
            font-size: 1rem;
            color: #1f2937;
        }

        .goal-input::placeholder {
            color: #9ca3af;
        }

        .goal-submit {
            background: #1d72f3;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .goal-submit:hover {
            background: #1557c7;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Section Header */
        .section-header {
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .section-description {
            font-size: 1rem;
            color: #6b7280;
        }

        /* Segment Definition Cards */
        .filter-list {
            display: grid;
            grid-template-columns: 1fr 80px;
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .filters-column {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .and-column {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .filter-and-slab {
            background: #d1fae5;
            color: #065f46;
            font-size: 0.875rem;
            font-weight: 700;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
        }

        /* Excludes Section */
        .excludes-section {
            margin-top: 2rem;
            background: linear-gradient(to bottom, rgba(243, 244, 246, 0.5), rgba(249, 250, 251, 0.3));
            border: 2px dashed #d1d5db;
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .excludes-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.25rem;
        }

        .excludes-label {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: #6b7280;
        }

        .add-exclusion-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.125rem;
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            color: #6b7280;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-exclusion-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
            transform: translateY(-1px);
        }

        .excludes-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .exclude-card {
            background: white;
            border: 2px dashed #d1d5db;
            border-left: 4px solid #9ca3af;
            border-radius: 0.5rem;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .exclude-card:hover {
            border-color: #9ca3af;
            box-shadow: 0 4px 12px rgba(156, 163, 175, 0.12);
        }

        .exclude-content {
            flex: 1;
        }

        .exclude-text {
            font-size: 0.9375rem;
            color: #6b7280;
            line-height: 1.6;
        }

        .exclude-text strong {
            color: #4b5563;
            font-weight: 600;
        }

        .exclude-actions {
            display: flex;
            gap: 0.5rem;
        }

        .filter-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-left: 4px solid #1d72f3;
            transition: box-shadow 0.2s;
            min-height: 60px;
        }

        .filter-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .filter-card.highlight {
            border-left-color: #fbbf24;
        }

        .filter-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .filter-text {
            font-size: 0.9375rem;
            color: #1f2937;
        }

        .filter-text strong {
            font-weight: 600;
        }

        .filter-actions {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: none;
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            border-radius: 0.375rem;
            cursor: pointer;
            color: #6b7280;
            transition: all 0.2s;
        }

        .icon-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        /* Quick Filters Panel */
        .quick-filters-section {
            margin-bottom: 2rem;
        }

        .quick-filters-trigger {
            background: white;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.25rem 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }

        .quick-filters-trigger:hover {
            border-color: #1d72f3;
            background: #f9fafb;
        }

        .trigger-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .trigger-icon {
            width: 24px;
            height: 24px;
            color: #1d72f3;
        }

        .trigger-text {
            font-size: 1rem;
            font-weight: 500;
            color: #1f2937;
        }

        .trigger-arrow {
            width: 20px;
            height: 20px;
            color: #6b7280;
            transition: transform 0.3s;
        }

        .trigger-arrow.open {
            transform: rotate(180deg);
        }

        .quick-filters-panel {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .quick-filters-panel.open {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quick-filters-header {
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .quick-filters-title {
            font-size: 1.0625rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .quick-filters-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .quick-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem;
        }

        .quick-filter-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-filter-item:hover {
            background: #eff6ff;
            border-color: #1d72f3;
            box-shadow: 0 2px 4px rgba(29, 114, 243, 0.1);
        }

        .quick-filter-item-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quick-filter-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .quick-filter-info {
            flex: 1;
        }

        .quick-filter-name {
            font-size: 0.9375rem;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .quick-filter-detail {
            font-size: 0.8125rem;
            color: #6b7280;
        }

        /* Channel Affinity */
        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .channel-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.25rem 1.5rem;
        }

        .channel-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .channel-icon {
            width: 48px;
            height: 48px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            background: #eff6ff;
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .channel-badge {
            display: inline-block;
            padding: 0.25rem 0.625rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
            background: #1d72f3;
            color: white;
            margin-left: 0.5rem;
        }

        .channel-engagement {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .channel-bar-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .channel-bar {
            flex: 1;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
        }

        .channel-bar-fill {
            height: 100%;
            background: #1d72f3;
            transition: width 0.6s ease-out;
        }

        .channel-percentage {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
            min-width: 50px;
            text-align: right;
        }

        .channel-insight {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: #1e40af;
        }

        .channel-source {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-left: 3px solid #1d72f3;
            border-radius: 0.375rem;
            padding: 0.875rem 1rem;
            margin-top: 1rem;
            font-size: 0.8125rem;
            color: #6b7280;
        }

        /* Smart Splits */
        .split-controls-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .split-controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .split-controls-title {
            font-size: 1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .reset-link {
            font-size: 0.875rem;
            color: #1d72f3;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0.5rem;
            border-radius: 0.25rem;
            transition: background 0.2s;
        }

        .reset-link:hover {
            background: #eff6ff;
        }

        .split-slider-wrapper {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .split-display {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .split-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .split-emoji {
            font-size: 1.25rem;
        }

        .split-percentage-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            min-width: 60px;
        }

        .split-slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #1d72f3 0%, #1d72f3 50%, #10b981 50%, #10b981 100%);
            outline: none;
            cursor: pointer;
        }

        .split-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #1d72f3;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .split-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 2px solid #1d72f3;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .splits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .split-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }

        .split-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .split-name-section {
            flex: 1;
        }

        .split-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .split-label {
            font-size: 0.8125rem;
            color: #6b7280;
        }

        .split-size {
            text-align: right;
        }

        .split-size-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-bottom: 0.25rem;
        }

        .split-size-value {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
        }

        .split-offer {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .split-offer-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .split-offer-title {
            font-size: 1.0625rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .split-offer-channel {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .split-audience {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .split-audience-label {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .split-audience-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.375rem;
            background: #eff6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-change {
            font-size: 0.8125rem;
            color: #10b981;
            margin-top: 0.5rem;
        }

        .insights-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .insight-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }

        .insight-card-title {
            font-size: 1.0625rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1.5rem;
        }

        .insight-items {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .insight-item {
            background: #f9fafb;
            border-left: 3px solid #1d72f3;
            border-radius: 0.25rem;
            padding: 0.875rem 1rem;
            font-size: 0.875rem;
            color: #1f2937;
        }

        .insight-item strong {
            font-weight: 600;
            color: #1d72f3;
        }

        /* Performance Cards */
        .performance-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .performance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .performance-title {
            font-size: 1.0625rem;
            font-weight: 600;
            color: #1f2937;
        }

        .performance-badge {
            font-size: 0.75rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 0.375rem 0.75rem;
            border-radius: 0.25rem;
        }

        .performance-items {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .performance-item {
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 1rem;
        }

        .performance-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .performance-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .performance-name {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .performance-emoji {
            font-size: 1.5rem;
        }

        .performance-text {
            font-size: 0.9375rem;
            font-weight: 500;
            color: #1f2937;
        }

        .performance-result {
            text-align: right;
        }

        .performance-percentage {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }

        .performance-delta {
            font-size: 0.8125rem;
            color: #10b981;
        }

        .performance-bar-bg {
            height: 10px;
            background: #f3f4f6;
            border-radius: 5px;
            overflow: hidden;
        }

        .performance-bar-fill {
            height: 100%;
            background: #1d72f3;
            transition: width 0.6s ease-out;
        }

        .winner-banner {
            background: #d1fae5;
            border: 1px solid #6ee7b7;
            border-radius: 0.375rem;
            padding: 1rem;
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #065f46;
        }

        .winner-banner strong {
            font-weight: 600;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        .btn-nav {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-nav-secondary {
            background: white;
            border: 1px solid #e5e7eb;
            color: #1f2937;
        }

        .btn-nav-secondary:hover {
            background: #f9fafb;
        }

        .btn-nav-primary {
            background: #1d72f3;
            border: none;
            color: white;
        }

        .btn-nav-primary:hover {
            background: #1557c7;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tab-navigation {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .quick-filters-grid {
                grid-template-columns: 1fr;
            }

            .splits-grid {
                grid-template-columns: 1fr;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .insights-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <div class="header-left">
            <button class="back-button" onclick="window.location.reload()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
            <div class="segment-title">
                <svg class="segment-icon" viewBox="0 0 24 24" fill="white" stroke="none" style="width: 24px; height: 24px;">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                <span class="segment-name" id="segmentName">Data Cloud Segment Builder</span>
            </div>
        </div>
        <div class="header-right">
            <div class="header-icons">
                <button class="header-icon-btn" title="Search">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="Recent Activity">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="Notifications">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="Data Sources">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                        <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="Settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6M5.64 5.64l4.24 4.24m4.24 4.24l4.24 4.24M1 12h6m6 0h6M5.64 18.36l4.24-4.24m4.24-4.24l4.24-4.24"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="Help & Support">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                </button>
                <button class="header-icon-btn" title="User Profile">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Segment Toolbar -->
    <div id="segmentToolbar" style="background: white; border-bottom: 1px solid #e5e7eb; padding: 1rem 1.5rem; display: none; align-items: center; justify-content: space-between;">
        <!-- Left Side: Population Metrics -->
        <div style="display: flex; align-items: center; gap: 1.5rem;">
            <!-- Action Buttons -->
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <button style="width: 36px; height: 36px; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #6b7280; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'" title="Undo">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 7v6h6"/>
                        <path d="M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"/>
                    </svg>
                </button>
                <button style="width: 36px; height: 36px; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #6b7280; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'" title="Redo">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 7v6h-6"/>
                        <path d="M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"/>
                    </svg>
                </button>
            </div>

            <!-- Population Count -->
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <button style="width: 36px; height: 36px; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; cursor: pointer; display: flex; align-items: center; justify-content: center; color: #6b7280; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'" title="Refresh">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0118.8-4.3M22 12.5a10 10 0 01-18.8 4.2"/>
                    </svg>
                </button>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <div style="font-size: 1.75rem; font-weight: 700; color: #1f2937;" id="toolbarAudienceCount">12,487</div>
                    <div style="font-size: 0.9375rem; color: #6b7280;">Unified Individuals</div>
                </div>
            </div>

            <!-- Percentage Badge -->
            <div style="display: flex; align-items: center; gap: 0.5rem; background: #eff6ff; padding: 0.5rem 1rem; border-radius: 0.375rem;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="#3b82f6">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                <span style="font-size: 0.9375rem; color: #1e40af; font-weight: 500;">0.4% of 3,286,468 total population</span>
            </div>
        </div>

        <!-- Right Side: Action Buttons -->
        <div style="display: flex; align-items: center; gap: 0.75rem;">
            <button style="padding: 0.5rem 1.25rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; color: #374151; font-size: 0.9375rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                Edit Properties
            </button>
            <button style="padding: 0.5rem 1.25rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background: white; color: #374151; font-size: 0.9375rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'" onclick="alert('Closing segment builder...')">
                Close
            </button>
            <button style="padding: 0.5rem 1.25rem; border: none; border-radius: 0.375rem; background: #1d72f3; color: white; font-size: 0.9375rem; font-weight: 500; cursor: pointer; transition: all 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05);" onmouseover="this.style.background='#1557b0'" onmouseout="this.style.background='#1d72f3'" onclick="alert('Segment saved successfully!')">
                Save
            </button>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div id="tabNavigation" class="tab-navigation" style="display: none;">
        <button class="tab-item" onclick="switchTab(0)" id="tab0">Segment Definition</button>
        <button class="tab-item" onclick="switchTab(1)" id="tab1">Rank and Limit</button>
        <button class="tab-item" onclick="switchTab(2)" id="tab2">Segment Preview</button>
        <button class="tab-item" onclick="switchTab(3)" id="tab3">Segment Insights</button>
        <button class="tab-item" onclick="switchTab(4)" id="tab4">Overlap Analysis</button>
        <button class="tab-item" onclick="switchTab(5)" id="tab5">Channel Affinity</button>
        <button class="tab-item" onclick="switchTab(6)" id="tab6">Smart Splits</button>
        <button class="tab-item" onclick="switchTab(7)" id="tab7">Activate</button>
        <button class="tab-item" onclick="switchTab(8)" id="tab8">Segment Performance</button>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Welcome State -->
        <div id="welcomeState" class="welcome-state">
            <!-- Main Agent Container -->
            <div class="agent-main">
                <div class="agent-header">
                    <div class="agent-avatar">
                        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                    </div>
                    <h1 class="welcome-title">What's your goal for today?</h1>
                    <p class="welcome-subtitle">Select a common campaign or describe your own</p>
                </div>

                <!-- Goal Selection View -->
                <div id="goalSelectionView">
                    <!-- Custom Goal Input First -->
                    <div class="goal-input-container" style="margin-bottom: 1.5rem;">
                        <input type="text" class="goal-input" id="customGoalInput" placeholder="Describe your goal (e.g., Target outdoor enthusiasts in cold climates)">
                        <button type="button" class="goal-submit" onclick="startWithCustomGoal()">Continue</button>
                    </div>

                    <div class="divider-or">
                        <span>OR SELECT A COMMON CAMPAIGN</span>
                    </div>

                    <!-- Auto-suggested Goals Below -->
                    <div class="goal-suggestions">
                        <div class="goal-card" onclick="selectGoal('Win-back')">
                            <div class="goal-card-icon" style="background: #fef3c7;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Win-back</div>
                            <div class="goal-card-description">Win back recently churned customers</div>
                        </div>

                        <div class="goal-card" onclick="selectGoal('Growth & Monetization')">
                            <div class="goal-card-icon" style="background: #fae8ff;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                    <line x1="12" y1="19" x2="12" y2="5"/>
                                    <polyline points="5 12 12 5 19 12"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Growth & Monetization</div>
                            <div class="goal-card-description">Increase share of wallet from existing customers</div>
                        </div>

                        <div class="goal-card" onclick="selectGoal('Acquisition')">
                            <div class="goal-card-icon" style="background: #f0fdf4;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                    <circle cx="8.5" cy="7" r="4"/>
                                    <line x1="20" y1="8" x2="20" y2="14"/>
                                    <line x1="23" y1="11" x2="17" y2="11"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Acquisition</div>
                            <div class="goal-card-description">Find prospects similar to my best customers</div>
                        </div>

                        <div class="goal-card" onclick="selectGoal('Service Led Marketing')">
                            <div class="goal-card-icon" style="background: #dbeafe;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2">
                                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Service Led Marketing</div>
                            <div class="goal-card-description">Proactively engage customers frustrated with recent cases</div>
                        </div>

                        <div class="goal-card" onclick="selectGoal('Churn Prevention')">
                            <div class="goal-card-icon" style="background: #fee2e2;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 8v4l3 3"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Churn Prevention</div>
                            <div class="goal-card-description">Target at-risk customers with retention offers</div>
                        </div>

                        <div class="goal-card" onclick="selectGoal('Cross-sell & Upsell')">
                            <div class="goal-card-icon" style="background: #ede9fe;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#7c3aed" stroke-width="2">
                                    <polyline points="18 15 12 9 6 15"/>
                                </svg>
                            </div>
                            <div class="goal-card-title">Cross-sell & Upsell</div>
                            <div class="goal-card-description">Drive additional revenue with product recommendations</div>
                        </div>
                    </div>
                </div>

                <!-- Follow-up Questions View - Multi-step Conversation -->
                <div id="followupView" class="followup-container">
                    <!-- User's selected goal will appear here -->
                    <div id="userGoalMessage" style="display: none;" class="chat-message user-message">
                        <div class="chat-bubble">
                            <div class="chat-bubble-text" id="userGoalText"></div>
                        </div>
                    </div>

                    <!-- Agent acknowledges -->
                    <div id="agentAck" style="display: none;" class="chat-message">
                        <div class="chat-avatar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                            </svg>
                        </div>
                        <div class="chat-bubble">
                            <div class="chat-bubble-text">Great! Let me ask you a few questions to refine your segment. </div>
                        </div>
                    </div>

                    <!-- Dynamic Questions Container -->
                    <div id="dynamicQuestion" style="display: none;">
                        <!-- Questions will be dynamically inserted here -->
                    </div>

                    <!-- Strategies Container -->
                    <div id="strategiesContainer" style="display: none;">
                        <!-- Strategies will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Stats Sidebar -->
            <div class="stats-sidebar">
                <div class="stat-mini">
                    <div class="stat-mini-icon" style="background: #eff6ff;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="stat-mini-value">3.2M</div>
                    <div class="stat-mini-label">Profiles</div>
                </div>

                <div class="stat-mini">
                    <div class="stat-mini-icon" style="background: #fef3c7;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                            <ellipse cx="12" cy="5" rx="9" ry="3"/>
                            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                        </svg>
                    </div>
                    <div class="stat-mini-value">12</div>
                    <div class="stat-mini-label">Sources</div>
                </div>

                <div class="stat-mini">
                    <div class="stat-mini-icon" style="background: #f0fdf4;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6"/>
                        </svg>
                    </div>
                    <div class="stat-mini-value">847</div>
                    <div class="stat-mini-label">Segments</div>
                </div>

                <div class="stat-mini">
                    <div class="stat-mini-icon" style="background: #fae8ff;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                    </div>
                    <div class="stat-mini-value">400</div>
                    <div class="stat-mini-label">Activations</div>
                </div>
            </div>
        </div>

        <!-- Tab 0: Segment Definition -->
        <div id="tabContent0" class="tab-content">
            <div class="section-header">
                <h2 class="section-title" id="segmentTitle">High Value Outdoor Enthusiasts</h2>
                <p class="section-description" id="segmentDescription">Our most engaged outdoor enthusiasts who have a high history of premium purchases but haven't geared up recently</p>
            </div>

            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2.5">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span style="font-size: 1rem; font-weight: 600; color: #059669;">Includes</span>
                <span style="font-size: 0.875rem; color: #6b7280; margin-left: 0.25rem;">Criteria to match</span>
            </div>

            <div class="filter-list" id="filterList">
                <div class="filters-column" id="filtersColumn">
                    <div class="filter-card">
                        <div class="filter-content">
                            <span class="filter-text"><strong>Lifetime Value</strong> is equal to or greater than <strong>USD 7,000</strong></span>
                        </div>
                        <div class="filter-actions">
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="filter-card highlight">
                        <div class="filter-content">
                            <span class="filter-text"><strong>Product Interest</strong> is equal to <strong>Trekking Boots</strong></span>
                        </div>
                        <div class="filter-actions">
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="filter-card">
                        <div class="filter-content">
                            <span class="filter-text"><strong>Last Activity</strong> is more than <strong>180 Days ago</strong></span>
                        </div>
                        <div class="filter-actions">
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="and-column" id="andColumn">
                    <div class="filter-and-slab">AND</div>
                </div>
            </div>

            <div class="quick-filters-section">
                <div class="quick-filters-trigger" onclick="toggleQuickFilters()">
                    <div class="trigger-content">
                        <svg class="trigger-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                        <span class="trigger-text">Add from Quick Filters</span>
                    </div>
                    <svg class="trigger-arrow" id="triggerArrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </div>
                <div class="quick-filters-panel" id="quickFiltersPanel">
                    <div class="quick-filters-header">
                        <h3 class="quick-filters-title">Select from Quick Filters to Refine Segment</h3>
                        <p class="quick-filters-desc">Click any attribute to add it to your segment criteria</p>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <input type="text" placeholder="Search filters..." style="width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937; outline: none; transition: all 0.2s;" onfocus="this.style.borderColor='#1d72f3'; this.style.boxShadow='0 0 0 3px rgba(29,114,243,0.1)'" onblur="this.style.borderColor='#d1d5db'; this.style.boxShadow='none'">
                    </div>
                    <div class="quick-filters-grid">
                        <div class="quick-filter-item" onclick="addQuickFilter('Region: Pacific Northwest', '', exclusionMode, exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Pacific Northwest</div>
                                    <div class="quick-filter-detail">Geographic region filter</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Device: Mobile', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Mobile Users</div>
                                    <div class="quick-filter-detail">Primary device type</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Age Group: 25-44', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Age 25-44</div>
                                    <div class="quick-filter-detail">Demographic segment</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Purchase Frequency: High', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">High Frequency</div>
                                    <div class="quick-filter-detail">4+ purchases/month</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Email Engagement: Active', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Email Active</div>
                                    <div class="quick-filter-detail">Opened in last 30 days</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Loyalty Tier: Gold', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Gold Member</div>
                                    <div class="quick-filter-detail">Loyalty program tier</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Season: Winter', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">Winter Season</div>
                                    <div class="quick-filter-detail">Seasonal preference</div>
                                </div>
                            </div>
                        </div>
                        <div class="quick-filter-item" onclick="addQuickFilter('Income Level: High', '', exclusionMode)">
                            <div class="quick-filter-item-content">
                                <span class="quick-filter-icon"></span>
                                <div class="quick-filter-info">
                                    <div class="quick-filter-name">High Income</div>
                                    <div class="quick-filter-detail">$100K+ annual income</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Excludes Section -->
            <div class="excludes-section" id="excludesSection">
                <div class="excludes-header">
                    <div class="excludes-label">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="15" y1="9" x2="9" y2="15"/>
                            <line x1="9" y1="9" x2="15" y2="15"/>
                        </svg>
                        <span>Excludes</span>
                        <span style="font-size: 0.875rem; color: #9ca3af; font-weight: 400; margin-left: 0.25rem;">Criteria to filter out</span>
                    </div>
                    <button class="add-exclusion-btn" onclick="toggleQuickFiltersForExclusion()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"/>
                            <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                        Add Exclusion
                    </button>
                </div>
                
                <div class="excludes-list" id="excludesList">
                    <div class="exclude-card">
                        <div class="exclude-content">
                            <span class="exclude-text"><strong>Contact Recency</strong> is less than <strong>7 days</strong></span>
                        </div>
                        <div class="exclude-actions">
                            <button class="icon-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" disabled style="visibility: hidden;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(1)">
                    Next: Rank and Limit
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 1: Rank and Limit -->
        <div id="tabContent1" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Rank and Limit</h2>
                <p class="section-description">Transform your broad segment into highly specific, actionable audiences</p>
            </div>

            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 2rem;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #1e40af; margin-bottom: 0.75rem;">What is Group, Rank, and Limit (GRL)?</h4>
                <p style="font-size: 0.875rem; color: #1e3a8a; line-height: 1.6;">
                    GRL allows you to organize records into meaningful groups, prioritize them based on defined business rules, and control segment sizes. 
                    This transforms broad segments into the <strong>best-of-the-best</strong> audiences for high-value campaigns.
                </p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                    <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                    <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Group (The Bucket)</div>
                    <div style="font-size: 0.8125rem; color: #6b7280;">Gather members into buckets by City (London, Tokyo, etc.)</div>
                </div>
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                    <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                    <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Rank (The Priority)</div>
                    <div style="font-size: 0.8125rem; color: #6b7280;">Sort members by Lifetime Points within each city</div>
                </div>
                <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                    <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                    <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Limit (The Quantity)</div>
                    <div style="font-size: 0.8125rem; color: #6b7280;">Select only the Top 5 from each city</div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 1.25rem;">Configure Your GRL Rules</h4>
                
                <!-- Step 1: Group -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                        <span style="color: #1d72f3; margin-right: 0.25rem;">1.</span> Group By
                    </label>
                    <select style="width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937; background: white; cursor: pointer;">
                        <option value="">Select attribute to group by...</option>
                        <option value="region" selected>Geographic Region</option>
                        <option value="city">City</option>
                        <option value="account">Account ID</option>
                        <option value="loyalty">Loyalty Tier</option>
                    </select>
                    <div style="font-size: 0.8125rem; color: #6b7280; margin-top: 0.5rem;">
                        Example: Group by <strong>Geographic Region</strong> to ensure fair distribution across all areas
                    </div>
                </div>

                <!-- Step 2: Rank -->
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                        <span style="color: #1d72f3; margin-right: 0.25rem;">2.</span> Rank By
                    </label>
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.75rem;">
                        <select style="padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937; background: white; cursor: pointer;">
                            <option value="">Select ranking attribute...</option>
                            <option value="ltv" selected>Lifetime Value (LTV)</option>
                            <option value="points">Loyalty Points</option>
                            <option value="recency">Last Purchase Date</option>
                            <option value="engagement">Engagement Score</option>
                        </select>
                        <select style="padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937; background: white; cursor: pointer;">
                            <option value="desc" selected>Descending (Highest First)</option>
                            <option value="asc">Ascending (Lowest First)</option>
                        </select>
                    </div>
                    <div style="font-size: 0.8125rem; color: #6b7280; margin-top: 0.5rem;">
                        Example: Rank by <strong>Lifetime Value</strong> in descending order to prioritize highest-value customers
                    </div>
                </div>

                <!-- Step 3: Limit -->
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                        <span style="color: #1d72f3; margin-right: 0.25rem;">3.</span> Limit To
                    </label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="number" value="10" min="1" max="1000" style="width: 120px; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937;">
                        <span style="font-size: 0.9375rem; color: #6b7280;">records per group</span>
                    </div>
                    <div style="font-size: 0.8125rem; color: #6b7280; margin-top: 0.5rem;">
                        Example: Limit to <strong>Top 10</strong> customers per region for a focused, high-value campaign
                    </div>
                </div>
            </div>

            <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: start; gap: 0.75rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#92400e" stroke-width="2" style="flex-shrink: 0; margin-top: 0.125rem;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <div style="font-size: 0.875rem; color: #78350f; line-height: 1.6;">
                        <strong>Result Preview:</strong> Your segment of <strong>12,487 customers</strong> will be refined to approximately <strong>500 top customers</strong> 
                        (10 per region  ~50 regions). This ensures you target only the highest-value individuals while maintaining geographic balance.
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem;">
                <h4 style="font-size: 0.9375rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Why Use Rank and Limit?</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; font-size: 0.875rem; color: #6b7280; line-height: 1.6;">
                    <div>
                        <strong style="color: #1f2937;"> Precision Targeting:</strong> Focus on best-fit customers instead of everyone who qualifies
                    </div>
                    <div>
                        <strong style="color: #1f2937;"> Resource Optimization:</strong> Control campaign costs by limiting audience size
                    </div>
                    <div>
                        <strong style="color: #1f2937;"> Fair Distribution:</strong> Ensure representation across all groups (regions, accounts, etc.)
                    </div>
                    <div>
                        <strong style="color: #1f2937;"> No SQL Required:</strong> Simple point-and-click interface for complex logic
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(0)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(2)">
                    Next: Segment Preview
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 2: Segment Preview -->
        <div id="tabContent2" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Segment Preview</h2>
                <p class="section-description">Explore your segment population with detailed records and key insights</p>
            </div>

            <!-- High-Level Segment Summary Bar -->
            <div style="background: linear-gradient(135deg, #1d72f3 0%, #1e40af 100%); border-radius: 0.75rem; padding: 1.25rem 1.75rem; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 2.5rem; flex-wrap: wrap;">
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Total Audience</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: white;">45,700</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: rgba(255,255,255,0.2);"></div>
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Avg LTV</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: white;">$8,450</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: rgba(255,255,255,0.2);"></div>
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Top Tier</div>
                        <div style="font-size: 1.375rem; font-weight: 700; color: white;">Gold (47%)</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: rgba(255,255,255,0.2);"></div>
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Avg Age</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: white;">34.2</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: rgba(255,255,255,0.2);"></div>
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Gender Split</div>
                        <div style="font-size: 1.375rem; font-weight: 700; color: white;">60% M / 40% F</div>
                    </div>
                    <div style="width: 1px; height: 40px; background: rgba(255,255,255,0.2);"></div>
                    <div>
                        <div style="font-size: 0.8125rem; color: rgba(255,255,255,0.8); margin-bottom: 0.25rem;">Top Region</div>
                        <div style="font-size: 1.375rem; font-weight: 700; color: white;">US (53%)</div>
                    </div>
                </div>
            </div>

            <!-- Sample Data Table -->
            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.75rem; padding: 1.75rem; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.25rem;">
                            Sample Records
                        </h3>
                        <p style="font-size: 0.875rem; color: #6b7280;">Showing 50 records from your segment</p>
                    </div>
                    <div style="display: flex; gap: 0.75rem;">
                        <input type="text" placeholder="Filter by name, email, region..." style="width: 300px; padding: 0.625rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                        <button style="padding: 0.625rem 1.25rem; background: #1d72f3; border: none; border-radius: 0.375rem; color: white; font-size: 0.875rem; font-weight: 600; cursor: pointer;">
                            Export Sample
                        </button>
                    </div>
                </div>

                <!-- Table -->
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.875rem;">
                        <thead>
                            <tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Customer ID</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Name</th>
                                <!-- Filter Criteria Attributes First -->
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #1d72f3; white-space: nowrap;"> LTV</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #1d72f3; white-space: nowrap;"> Age</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #1d72f3; white-space: nowrap;"> Loyalty Tier</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #1d72f3; white-space: nowrap;"> Region</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #1d72f3; white-space: nowrap;"> Active Status</th>
                                <!-- Additional Attributes -->
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Email</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Gender</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Annual Income</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Last Purchase</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Total Orders</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Avg Order Value</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Churn Risk</th>
                                <th style="padding: 0.875rem; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">Channel Pref</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-10281</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Sarah Johnson</td>
                                <!-- Filter Criteria First -->
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$8,240</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">32</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Gold</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Pacific NW</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <!-- Additional Attributes -->
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">sarah.j@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">F</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$95K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">245 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">18</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$458</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">High</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Mobile Push</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-10742</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Michael Chen</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$12,100</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">28</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #e0e7ff; color: #3730a3; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Platinum</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">West Coast</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">m.chen@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">M</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$115K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">198 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">24</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$504</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef9c3; color: #854d0e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">Med</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Email</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-11029</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Emma Rodriguez</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$7,520</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">41</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Gold</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Southwest</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">emma.r@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">F</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$78K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">210 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">16</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$470</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">High</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">SMS</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-11384</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">David Park</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$9,890</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">35</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Gold</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Pacific NW</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">d.park@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">M</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$105K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">183 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">21</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$471</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef9c3; color: #854d0e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">Med</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Mobile Push</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-11591</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Olivia Martinez</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$15,420</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">29</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #e0e7ff; color: #3730a3; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Platinum</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Northeast</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">olivia.m@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">F</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$135K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">225 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">32</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$482</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">High</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Email</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-11847</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">James Wilson</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$6,780</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">38</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Gold</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Midwest</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">j.wilson@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">M</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$72K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">267 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">14</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$484</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fee2e2; color: #991b1b; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">High</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">In-App</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-12003</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Sophia Lee</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$11,200</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">26</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #e0e7ff; color: #3730a3; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Platinum</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">Pacific NW</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">sophia.lee@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">F</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$122K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">192 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">26</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$431</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef9c3; color: #854d0e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">Med</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Mobile Push</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">CUST-12289</td>
                                <td style="padding: 0.875rem; color: #1f2937; font-weight: 500; white-space: nowrap;">Daniel Kim</td>
                                <td style="padding: 0.875rem; color: #059669; font-weight: 600; white-space: nowrap;">$8,650</td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">33</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef3c7; color: #92400e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Gold</span></td>
                                <td style="padding: 0.875rem; color: #1f2937; white-space: nowrap;">West Coast</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #d1fae5; color: #065f46; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; font-weight: 600;">Active</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">d.kim@email.com</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">M</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$91K</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">201 days ago</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">19</td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">$455</td>
                                <td style="padding: 0.875rem; white-space: nowrap;"><span style="background: #fef9c3; color: #854d0e; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem;">Med</span></td>
                                <td style="padding: 0.875rem; color: #6b7280; white-space: nowrap;">Email</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e5e7eb;">
                    <div style="font-size: 0.875rem; color: #6b7280;">
                        Showing 1-50 of 12,487 records
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; font-size: 0.875rem; color: #6b7280; cursor: pointer;">Previous</button>
                        <button style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; font-size: 0.875rem; color: #1f2937; font-weight: 600; cursor: pointer;">1</button>
                        <button style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; font-size: 0.875rem; color: #6b7280; cursor: pointer;">2</button>
                        <button style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; font-size: 0.875rem; color: #6b7280; cursor: pointer;">3</button>
                        <button style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 0.375rem; font-size: 0.875rem; color: #6b7280; cursor: pointer;">Next</button>
                    </div>
                </div>
            </div>


            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(3)">
                    Next: Segment Insights
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 5: Channel Affinity -->
        <div id="tabContent5" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Channel Affinity Analysis</h2>
                <p class="section-description">These channels perform best with your target audience</p>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Why Look at Channel Affinity?</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem;">
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Optimize Engagement</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Reach your audience on channels where they're most active</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Reduce Waste</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Avoid spending on channels with low engagement potential</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Data-Driven Strategy</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Make informed decisions based on historical performance</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Perfect Timing</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Send messages when your audience is most likely to respond</div>
                    </div>
                </div>
            </div>

            <div class="channel-list">
                <div class="channel-card">
                    <div class="channel-header">
                        <div class="channel-icon"></div>
                        <div class="channel-info">
                            <div class="channel-name">
                                Mobile Push
                                <span class="channel-badge">Top Pick</span>
                            </div>
                            <div class="channel-engagement">High engagement potential</div>
                        </div>
                    </div>
                    <div class="channel-bar-container">
                        <div class="channel-bar">
                            <div class="channel-bar-fill" style="width: 70%"></div>
                        </div>
                        <div class="channel-percentage">70%</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.625rem; background: #eff6ff; border-radius: 0.375rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="flex-shrink: 0;">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span style="font-size: 0.8125rem; color: #1e40af;">Best window: <strong>12:00 PM - 2:00 PM</strong></span>
                    </div>
                </div>

                <div class="channel-card">
                    <div class="channel-header">
                        <div class="channel-icon"></div>
                        <div class="channel-info">
                            <div class="channel-name">SMS</div>
                            <div class="channel-engagement">Medium engagement potential</div>
                        </div>
                    </div>
                    <div class="channel-bar-container">
                        <div class="channel-bar">
                            <div class="channel-bar-fill" style="width: 55%"></div>
                        </div>
                        <div class="channel-percentage">55%</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.625rem; background: #eff6ff; border-radius: 0.375rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="flex-shrink: 0;">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span style="font-size: 0.8125rem; color: #1e40af;">Best window: <strong>10:00 AM - 12:00 PM</strong></span>
                    </div>
                </div>

                <div class="channel-card">
                    <div class="channel-header">
                        <div class="channel-icon"></div>
                        <div class="channel-info">
                            <div class="channel-name">Email</div>
                            <div class="channel-engagement">Lower engagement potential</div>
                        </div>
                    </div>
                    <div class="channel-bar-container">
                        <div class="channel-bar">
                            <div class="channel-bar-fill" style="width: 35%"></div>
                        </div>
                        <div class="channel-percentage">35%</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.625rem; background: #eff6ff; border-radius: 0.375rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="flex-shrink: 0;">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span style="font-size: 0.8125rem; color: #1e40af;">Best window: <strong>6:00 PM - 8:00 PM</strong></span>
                    </div>
                </div>

                <div class="channel-card">
                    <div class="channel-header">
                        <div class="channel-icon"></div>
                        <div class="channel-info">
                            <div class="channel-name">In-App</div>
                            <div class="channel-engagement">Medium engagement potential</div>
                        </div>
                    </div>
                    <div class="channel-bar-container">
                        <div class="channel-bar">
                            <div class="channel-bar-fill" style="width: 18%"></div>
                        </div>
                        <div class="channel-percentage">18%</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; padding: 0.625rem; background: #eff6ff; border-radius: 0.375rem;">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="flex-shrink: 0;">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        <span style="font-size: 0.8125rem; color: #1e40af;">Best window: <strong>9:00 AM - 11:00 AM</strong></span>
                    </div>
                </div>
            </div>

            <div class="channel-insight">
                <strong>Insight:</strong> 70% of this segment responds better to Mobile Push notifications. Consider prioritizing this channel for maximum engagement.
            </div>

            <div class="channel-source">
                This data is based on performance analysis from <strong>847 previously run campaigns</strong> targeting similar audience segments.
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(4)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(6)">
                    Next: Smart Splits
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 6: Smart Splits -->
        <div id="tabContent6" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Smart Splits</h2>
                <p class="section-description">Create optimized test variants to maximize campaign performance</p>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Why Use Smart Splits?</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem;">
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">A/B Testing</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Test different offers and messaging to find what resonates best</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Risk Mitigation</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Reduce campaign risk by testing variants before full rollout</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Data-Driven Decisions</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Make informed choices based on real performance data</div>
                    </div>
                    <div style="background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 1.25rem; margin-bottom: 0.5rem;"></div>
                        <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Maximize ROI</div>
                        <div style="font-size: 0.8125rem; color: #6b7280;">Identify the highest-performing variant to scale for better returns</div>
                    </div>
                </div>
            </div>

            <div class="split-controls-card">
                <div class="split-controls-header">
                    <h3 class="split-controls-title">Adjust Split Percentages</h3>
                    <button class="reset-link" onclick="resetSplit()">Reset to 50/50</button>
                </div>
                <div class="split-slider-wrapper">
                    <div class="split-display">
                        <div class="split-item">
                            <span class="split-emoji"></span>
                            <span class="split-percentage-text"><span id="splitA">50</span>%</span>
                        </div>
                    </div>
                    <input type="range" min="10" max="90" value="50" class="split-slider" id="splitSlider" oninput="updateSplit(this.value)">
                    <div class="split-display">
                        <div class="split-item">
                            <span class="split-emoji"></span>
                            <span class="split-percentage-text"><span id="splitB">50</span>%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="splits-grid">
                <div class="split-card">
                    <div class="split-card-header">
                        <div class="split-name-section">
                            <div class="split-name"> Push Discount</div>
                            <div class="split-label">Split 1 of 2</div>
                        </div>
                        <div class="split-size">
                            <div class="split-size-label">Split Size</div>
                            <div class="split-size-value"><span id="splitACard">50</span>%</div>
                        </div>
                    </div>
                    <div class="split-offer">
                        <div class="split-offer-icon"></div>
                        <div class="split-offer-title">15% Discount</div>
                        <div class="split-offer-channel">via Mobile Push</div>
                    </div>
                    <div class="split-audience">
                        <div class="split-audience-label">Audience</div>
                        <div class="split-audience-count" id="audienceA">6,244</div>
                    </div>
                </div>

                <div class="split-card">
                    <div class="split-card-header">
                        <div class="split-name-section">
                            <div class="split-name"> SMS Free Ship</div>
                            <div class="split-label">Split 2 of 2</div>
                        </div>
                        <div class="split-size">
                            <div class="split-size-label">Split Size</div>
                            <div class="split-size-value"><span id="splitBCard">50</span>%</div>
                        </div>
                    </div>
                    <div class="split-offer">
                        <div class="split-offer-icon"></div>
                        <div class="split-offer-title">Free Shipping</div>
                        <div class="split-offer-channel">via SMS</div>
                    </div>
                    <div class="split-audience">
                        <div class="split-audience-label">Audience</div>
                        <div class="split-audience-count" id="audienceB">6,243</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 1.5rem; padding: 1.5rem; background: white; border: 2px dashed #d1d5db; border-radius: 0.5rem; text-align: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1d72f3'; this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.background='white'" onclick="alert('Add Split functionality - You can create additional splits for multivariate testing!')">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="margin-bottom: 0.5rem;">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
                <div style="font-size: 0.9375rem; font-weight: 600; color: #1d72f3; margin-bottom: 0.25rem;">Add Another Split</div>
                <div style="font-size: 0.8125rem; color: #6b7280;">Create additional variants for multivariate testing</div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(5)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(7)">
                    Next: Activate
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 3: Segment Insights -->
        <div id="tabContent3" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Segment Insights</h2>
                <p class="section-description">Comprehensive analysis of your segment composition, behavior, and business impact</p>
            </div>

            <!-- Top Section: Composition + Overview Side by Side -->
            <div style="display: grid; grid-template-columns: 1.4fr 1fr; gap: 0.5rem; margin-bottom: 0.5rem;">
                <!-- Left: Composition -->
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                    <h3 style="font-size: 0.875rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem;">Segment Composition</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem;">
                        <!-- Country Chart -->
                        <div>
                            <div style="font-size: 0.6875rem; font-weight: 600; color: #374151; margin-bottom: 0.25rem; text-align: center;">Country</div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                                <svg width="60" height="60" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#6366f1" stroke-width="40" stroke-dasharray="234 206" stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#3b82f6" stroke-width="40" stroke-dasharray="137 303" stroke-dashoffset="-234" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#e5e7eb" stroke-width="40" stroke-dasharray="70 370" stroke-dashoffset="-371" transform="rotate(-90 100 100)"/>
                                </svg>
                                <div style="display: flex; flex-direction: column; gap: 0.125rem; font-size: 0.625rem;">
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #6366f1; border-radius: 1px;"></span><span>US 53%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #3b82f6; border-radius: 1px;"></span><span>EU 31%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #e5e7eb; border-radius: 1px;"></span><span>Other 16%</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Loyalty Tier Chart -->
                        <div>
                            <div style="font-size: 0.6875rem; font-weight: 600; color: #374151; margin-bottom: 0.25rem; text-align: center;">Loyalty Tier</div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                                <svg width="60" height="60" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#fbbf24" stroke-width="40" stroke-dasharray="207 233" stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#e0e7ff" stroke-width="40" stroke-dasharray="123 317" stroke-dashoffset="-207" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#c0c0c0" stroke-width="40" stroke-dasharray="110 330" stroke-dashoffset="-330" transform="rotate(-90 100 100)"/>
                                </svg>
                                <div style="display: flex; flex-direction: column; gap: 0.125rem; font-size: 0.625rem;">
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #fbbf24; border-radius: 1px;"></span><span>Gold 47%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #e0e7ff; border-radius: 1px;"></span><span>Plat 28%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #c0c0c0; border-radius: 1px;"></span><span>Silver 25%</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- LTV Tiers Chart -->
                        <div>
                            <div style="font-size: 0.6875rem; font-weight: 600; color: #374151; margin-bottom: 0.25rem; text-align: center;">LTV Tiers</div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                                <svg width="60" height="60" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#10b981" stroke-width="40" stroke-dasharray="370 70" stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#06b6d4" stroke-width="40" stroke-dasharray="132 308" stroke-dashoffset="-370" transform="rotate(-90 100 100)"/>
                                </svg>
                                <div style="display: flex; flex-direction: column; gap: 0.125rem; font-size: 0.625rem;">
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #10b981; border-radius: 1px;"></span><span>Top 20% 84%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #06b6d4; border-radius: 1px;"></span><span>Mid 30%</span></div>
                                </div>
                            </div>
                        </div>

                        <!-- Lifecycle Stages Chart -->
                        <div>
                            <div style="font-size: 0.6875rem; font-weight: 600; color: #374151; margin-bottom: 0.25rem; text-align: center;">Lifecycle Stages</div>
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                                <svg width="60" height="60" viewBox="0 0 200 200">
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#8b5cf6" stroke-width="40" stroke-dasharray="268 172" stroke-dashoffset="0" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#ec4899" stroke-width="40" stroke-dasharray="132 308" stroke-dashoffset="-268" transform="rotate(-90 100 100)"/>
                                    <circle cx="100" cy="100" r="70" fill="none" stroke="#f59e0b" stroke-width="40" stroke-dasharray="26 414" stroke-dashoffset="-400" transform="rotate(-90 100 100)"/>
                                </svg>
                                <div style="display: flex; flex-direction: column; gap: 0.125rem; font-size: 0.625rem;">
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #8b5cf6; border-radius: 1px;"></span><span>Active 61%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #ec4899; border-radius: 1px;"></span><span>At Risk 30%</span></div>
                                    <div style="display: flex; align-items: center; gap: 0.1875rem;"><span style="width: 6px; height: 6px; background: #f59e0b; border-radius: 1px;"></span><span>New 6%</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right: Quick Overview Metrics -->
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                    <div style="background: linear-gradient(135deg, #1d72f3 0%, #1e40af 100%); border-radius: 0.5rem; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.625rem; color: rgba(255,255,255,0.8); margin-bottom: 0.1875rem;">Audience Size</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: white;">45,700</div>
                        <div style="font-size: 0.5625rem; color: rgba(255,255,255,0.9);">+3.2% vs baseline</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 0.5rem; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.625rem; color: rgba(255,255,255,0.8); margin-bottom: 0.1875rem;">Net Change</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: white;">+5,100</div>
                        <div style="font-size: 0.5625rem; color: rgba(255,255,255,0.9);">+12.6% since last run</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 0.5rem; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.625rem; color: rgba(255,255,255,0.8); margin-bottom: 0.1875rem;">Avg LTV</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: white;">$8,450</div>
                        <div style="font-size: 0.5625rem; color: rgba(255,255,255,0.9);">Top 15% overall</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 0.5rem; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.625rem; color: rgba(255,255,255,0.8); margin-bottom: 0.1875rem;">Revenue at Risk</div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: white;">$2.94M</div>
                        <div style="font-size: 0.5625rem; color: rgba(255,255,255,0.9);">+8% vs last month</div>
                    </div>
                </div>
            </div>

            <!-- Dense Metrics Grid -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                
                <!-- Left Column: Behavior -->
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <!-- Engagement Metrics -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Engagement Patterns</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.375rem;">
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Purchase Freq</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">3.2x/yr</div>
                            </div>
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Avg Order</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">$425</div>
                            </div>
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Session Time</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">12.5 min</div>
                            </div>
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Cart Abandon</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #ef4444;">28%</div>
                            </div>
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Email Open</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">42%</div>
                            </div>
                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 0.3125rem;">
                                <div style="font-size: 0.5625rem; color: #6b7280; margin-bottom: 0.0625rem;">Click Rate</div>
                                <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">18%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Demographics -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Demographics</h3>
                        
                        <div style="display: grid; gap: 0.25rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Avg Age</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">34.2 years</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Gender Split</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">60% M / 40% F</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Avg Income</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">$98K</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Top Region</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">US Pacific NW</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Mobile Usage</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">73%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Avg Tenure</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">2.8 years</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Risk & Behavior -->
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <!-- Risk Distribution -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Risk Distribution</h3>
                        
                        <div style="margin-bottom: 0.375rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.1875rem;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">High Risk</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">65%</span>
                            </div>
                            <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                                <div style="height: 100%; width: 65%; background: linear-gradient(to right, #ef4444, #f87171); border-radius: 2px;"></div>
                            </div>
                        </div>

                        <div style="margin-bottom: 0.375rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.1875rem;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Medium Risk</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">23%</span>
                            </div>
                            <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                                <div style="height: 100%; width: 23%; background: linear-gradient(to right, #f59e0b, #fbbf24); border-radius: 2px;"></div>
                            </div>
                        </div>

                        <div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.1875rem;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Low Risk</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">12%</span>
                            </div>
                            <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                                <div style="height: 100%; width: 12%; background: linear-gradient(to right, #10b981, #34d399); border-radius: 2px;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Average Churn Score & Value Distribution -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <div style="font-size: 0.6875rem; color: #6b7280; margin-bottom: 0.1875rem;">Average Churn Score</div>
                            <div style="display: flex; align-items: baseline; gap: 0.3125rem;">
                                <div style="font-size: 1.4375rem; font-weight: 700; color: #1f2937;">77</div>
                                <div style="font-size: 0.6875rem; color: #6b7280;">64.2% Low</div>
                            </div>
                            <div style="height: 3px; background: linear-gradient(to right, #10b981 64.2%, #f59e0b 64.2%, #f59e0b 85%, #ef4444 85%); border-radius: 2px; margin-top: 0.3125rem;"></div>
                        </div>

                        <div style="border-top: 1px solid #e5e7eb; padding-top: 0.5rem;">
                            <div style="font-size: 0.6875rem; color: #6b7280; margin-bottom: 0.1875rem;">Value Distribution</div>
                            <div style="display: flex; align-items: center; gap: 0.3125rem;">
                                <div style="font-size: 0.875rem; color: #6366f1;"></div>
                                <div>
                                    <div style="font-size: 0.625rem; color: #9ca3af;">Revenue</div>
                                    <div style="font-size: 1rem; font-weight: 700; color: #1f2937;">$248</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Top Inclusion Factors -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Top Inclusion Factors</h3>
                        
                        <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                            <div style="font-size: 0.625rem; color: #374151; padding: 0.1875rem 0; border-bottom: 1px solid #f3f4f6;">Low engagement in last 30 days</div>
                            <div style="font-size: 0.625rem; color: #374151; padding: 0.1875rem 0; border-bottom: 1px solid #f3f4f6;">Declining purchase frequency</div>
                            <div style="font-size: 0.625rem; color: #374151; padding: 0.1875rem 0; border-bottom: 1px solid #f3f4f6;">Reduced session time</div>
                            <div style="font-size: 0.625rem; color: #374151; padding: 0.1875rem 0; border-bottom: 1px solid #f3f4f6;">Payment issues</div>
                            <div style="font-size: 0.625rem; color: #374151; padding: 0.1875rem 0;">Inactive loyalty status</div>
                        </div>

                        <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #e5e7eb;">
                            <div style="height: 3px; background: linear-gradient(to right, #3b82f6 25%, #f59e0b 25%, #f59e0b 50%, #ef4444 50%); border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Impact & Governance -->
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <!-- Overlap & Governance -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Overlap & Governance</h3>
                        
                        <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.5rem;">
                            <div style="display: flex; align-items: center; justify-content: center; width: 38px; height: 38px; background: linear-gradient(135deg, #fef3c7 0%, #fbbf24 100%); border-radius: 0.3125rem;">
                                <span style="font-size: 1.125rem; font-weight: 700; color: #92400e;">18%</span>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 0.625rem; color: #9ca3af;">vs. Upsell Campaign</div>
                                <div style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">Overlap</div>
                            </div>
                        </div>

                        <div style="display: flex; align-items: center; gap: 0.375rem; padding-bottom: 0.5rem; border-bottom: 1px solid #e5e7eb;">
                            <div style="display: flex; align-items: center; justify-content: center; width: 38px; height: 38px; background: linear-gradient(135deg, #fce7f3 0%, #ec4899 100%); border-radius: 0.3125rem;">
                                <span style="font-size: 1.125rem; font-weight: 700; color: #831843;">9%</span>
                            </div>
                            <div style="flex: 1;">
                                <div style="font-size: 0.625rem; color: #9ca3af;">Suppressed by Caps</div>
                                <div style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">Governance</div>
                            </div>
                        </div>

                        <div style="margin-top: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.1875rem;">
                                <span style="font-size: 0.6875rem; font-weight: 600; color: #374151;">Drift Summary</span>
                                <span style="font-size: 0.75rem; font-weight: 600; color: #059669;">+1.6%</span>
                            </div>
                            <div style="font-size: 0.625rem; color: #6b7280; line-height: 1.3;">Loyalty Tier shift and a 3.1% increase in High Churn Probability</div>
                        </div>
                    </div>

                    <!-- Impact Projection -->
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                        <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Impact Projection</h3>
                        
                        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 0.4375rem; padding: 0.75rem; margin-bottom: 0.5rem;">
                            <div style="font-size: 0.625rem; color: #1e40af; margin-bottom: 0.125rem;">Estimated Lift</div>
                            <div style="font-size: 1.375rem; font-weight: 700; color: #1e3a8a; margin-bottom: 0.125rem;">+$3.0M</div>
                            <div style="display: inline-block; background: #dbeafe; color: #1d4ed8; padding: 0.15625rem 0.375rem; border-radius: 0.25rem; font-size: 0.5625rem; font-weight: 600;">High Confidence</div>
                        </div>

                        <div style="background: #f9fafb; border-radius: 0.3125rem; padding: 0.625rem; margin-bottom: 0.5rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.6875rem; color: #6b7280;">Expected ROI</span>
                                <span style="font-size: 1.125rem; font-weight: 700; color: #059669;">420%</span>
                            </div>
                        </div>

                        <div style="border-top: 1px solid #e5e7eb; padding-top: 0.625rem;">
                            <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.125rem;">Cost per Conversion</div>
                            <div style="font-size: 1.3125rem; font-weight: 700; color: #1f2937;">$27</div>
                            <div style="font-size: 0.625rem; color: #9ca3af;">Per incremental conversion</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Dense Metrics Row -->
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem; text-align: center;">
                    <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.1875rem;">Repeat Purchase</div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: #10b981;">68%</div>
                    <div style="font-size: 0.5625rem; color: #059669;">High loyalty</div>
                </div>
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem; text-align: center;">
                    <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.1875rem;">Days Since Purchase</div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">210</div>
                    <div style="font-size: 0.5625rem; color: #6b7280;">~7 months</div>
                </div>
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem; text-align: center;">
                    <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.1875rem;">Email Opt-in</div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">87%</div>
                    <div style="font-size: 0.5625rem; color: #6b7280;">Above avg</div>
                </div>
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem; text-align: center;">
                    <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.1875rem;">Mobile App Users</div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: #1f2937;">73%</div>
                    <div style="font-size: 0.5625rem; color: #6b7280;">High adoption</div>
                </div>
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 0.625rem; text-align: center;">
                    <div style="font-size: 0.625rem; color: #6b7280; margin-bottom: 0.1875rem;">Conversion Rate</div>
                    <div style="font-size: 1.25rem; font-weight: 700; color: #10b981;">16.4%</div>
                    <div style="font-size: 0.5625rem; color: #059669;">+5.2% vs avg</div>
                </div>
            </div>

            <!-- Channel Preference & Purchase Behavior -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-bottom: 0.5rem;">
                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                    <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Channel Engagement</h3>
                    <div style="display: grid; gap: 0.375rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.6875rem; color: #6b7280;"> Mobile Push</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">70%</span>
                        </div>
                        <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                            <div style="height: 100%; width: 70%; background: #1d72f3; border-radius: 2px;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.6875rem; color: #6b7280;"> SMS</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">55%</span>
                        </div>
                        <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                            <div style="height: 100%; width: 55%; background: #10b981; border-radius: 2px;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.6875rem; color: #6b7280;"> Email</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">35%</span>
                        </div>
                        <div style="height: 3px; background: #f3f4f6; border-radius: 2px; overflow: hidden;">
                            <div style="height: 100%; width: 35%; background: #f59e0b; border-radius: 2px;"></div>
                        </div>
                    </div>
                </div>

                <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.625rem; padding: 0.75rem;">
                    <h3 style="font-size: 0.8125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Purchase Patterns</h3>
                    <div style="display: grid; gap: 0.25rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                            <span style="font-size: 0.6875rem; color: #6b7280;">Total Spend</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">$40.5M</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                            <span style="font-size: 0.6875rem; color: #6b7280;">Total Orders</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">95,284</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                            <span style="font-size: 0.6875rem; color: #6b7280;">Peak Purchase Time</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">2-4 PM</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.25rem; border-bottom: 1px solid #f3f4f6;">
                            <span style="font-size: 0.6875rem; color: #6b7280;">Preferred Category</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #1f2937;">Outdoor Gear</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 0.6875rem; color: #6b7280;">Returns Rate</span>
                            <span style="font-size: 0.75rem; font-weight: 600; color: #10b981;">4.2%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(2)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(4)">
                    Next: Overlap Analysis
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 4: Overlap Analysis -->
        <div id="tabContent4" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Overlap Analysis</h2>
                <p class="section-description">Visualize overlap with other active and historical segments</p>
            </div>

            <div class="analytics-grid" style="display: none;">
                <!-- Row 1 -->
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Total Reachable</div>
                    <div class="stat-value">12,487</div>
                    <div class="stat-change">+2.3% vs last campaign</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Expected Reach</div>
                    <div class="stat-value">87.2%</div>
                    <div class="stat-change" style="color: #6b7280;">Based on channel affinity</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Gender Ratio</div>
                    <div class="stat-value">60:40</div>
                    <div class="stat-change" style="color: #6b7280;">Male : Female</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Average Age</div>
                    <div class="stat-value">34.2</div>
                    <div class="stat-change" style="color: #6b7280;">years old</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Top Age Group</div>
                    <div class="stat-value">25-34</div>
                    <div class="stat-change" style="color: #6b7280;">4,620 customers (37%)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Avg Lifetime Value</div>
                    <div class="stat-value">$3,240</div>
                    <div class="stat-change">+12% vs avg customer</div>
                </div>

                <!-- Row 2 -->
                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Top Region</div>
                    <div class="stat-value">Pacific NW</div>
                    <div class="stat-change" style="color: #6b7280;">2,847 customers (23%)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Avg Days Since Purchase</div>
                    <div class="stat-value">210</div>
                    <div class="stat-change" style="color: #6b7280;">~7 months inactive</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Past Purchase Rate</div>
                    <div class="stat-value">3.8x</div>
                    <div class="stat-change">Above average</div>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <div class="stat-icon"></div>
                    </div>
                    <div class="stat-label">Loyalty Status</div>
                    <div class="stat-value">Gold+</div>
                    <div class="stat-change" style="color: #6b7280;">89% are Gold or Platinum</div>
                </div>

            </div>

            <div style="background: white; border: 2px solid #1d72f3; border-radius: 0.75rem; padding: 1.75rem; margin: 2rem 0;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2">
                                <circle cx="12" cy="8" r="7"/>
                                <circle cx="12" cy="8" r="3"/>
                                <path d="M12 15v6"/>
                            </svg>
                            Segment Overlap Analysis
                        </h3>
                        <p style="font-size: 0.875rem; color: #6b7280;">Visualize overlap with other active and historical segments</p>
                    </div>
                    <div style="display: flex; gap: 0.75rem;">
                        <button onclick="filterOverlapSegments('week')" id="filterWeek" style="padding: 0.5rem 1rem; border: 2px solid #d1d5db; background: white; color: #6b7280; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            Last Week
                        </button>
                        <button onclick="filterOverlapSegments('month')" id="filterMonth" style="padding: 0.5rem 1rem; border: 2px solid #d1d5db; background: white; color: #6b7280; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            Last Month
                        </button>
                        <button onclick="filterOverlapSegments('all')" id="filterAll" style="padding: 0.5rem 1rem; border: 2px solid #1d72f3; background: #1d72f3; color: white; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                            All Segments
                        </button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 2rem;">
                    <!-- Left: Venn Diagram Visualization -->
                    <div>
                        <div style="margin-bottom: 1.25rem;">
                            <label style="display: block; font-size: 0.875rem; font-weight: 500; color: #374151; margin-bottom: 0.5rem;">
                                Compare with segment:
                            </label>
                            <select id="overlapSegmentSelector" onchange="updateOverlapVisualization(this.value)" style="width: 100%; padding: 0.75rem 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.9375rem; color: #1f2937; background: white; cursor: pointer;">
                                <option value="outdoor" data-period="week month">Outdoor Adventure Enthusiasts (Last Week + Last Month)</option>
                                <option value="winter" data-period="week">Winter Sports Promo (Last Week)</option>
                                <option value="holiday" data-period="month">Holiday Gift Guide (Last Month)</option>
                                <option value="premium" data-period="all">Premium Product Buyers (Active)</option>
                                <option value="loyalty" data-period="all">Loyalty Program - Gold Tier (Active)</option>
                                <option value="recentBuyers" data-period="all">Recent Buyers - 30 Days (Active)</option>
                            </select>
                        </div>

                        <!-- Venn Diagram -->
                        <div style="position: relative; height: 340px; background: #f9fafb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1rem;">
                            <svg width="100%" height="100%" viewBox="0 0 400 300" style="overflow: visible;">
                                <!-- Left Circle (Current Segment) -->
                                <circle id="vennCircle1" cx="140" cy="150" r="100" fill="#1d72f3" fill-opacity="0.3" stroke="#1d72f3" stroke-width="3"/>
                                
                                <!-- Right Circle (Comparison Segment) -->
                                <circle id="vennCircle2" cx="260" cy="150" r="100" fill="#10b981" fill-opacity="0.3" stroke="#10b981" stroke-width="3"/>
                                
                                <!-- Overlap region highlight (intersection) -->
                                <path id="vennOverlapPath" d="M 200 60 A 100 100 0 0 1 200 240 A 100 100 0 0 1 200 60" fill="#8b5cf6" fill-opacity="0.5"/>
                                
                                <!-- Labels -->
                                <text x="100" y="150" text-anchor="middle" font-size="14" font-weight="600" fill="#1e40af">
                                    <tspan x="100" dy="-10">Your</tspan>
                                    <tspan x="100" dy="20">Segment</tspan>
                                    <tspan x="100" dy="20" font-size="20" font-weight="700">12,487</tspan>
                                </text>
                                
                                <text id="vennCompareLabel" x="300" y="150" text-anchor="middle" font-size="14" font-weight="600" fill="#065f46">
                                    <tspan x="300" dy="-10">Outdoor</tspan>
                                    <tspan x="300" dy="20">Adventures</tspan>
                                    <tspan x="300" dy="20" font-size="20" font-weight="700">18,245</tspan>
                                </text>
                                
                                <text x="200" y="150" text-anchor="middle" font-size="16" font-weight="700" fill="#6b21a8">
                                    <tspan x="200" dy="-10">Overlap</tspan>
                                    <tspan x="200" dy="25" font-size="24">42%</tspan>
                                    <tspan x="200" dy="25" font-size="14" font-weight="600">5,244</tspan>
                                </text>
                            </svg>
                        </div>

                        <!-- Overlap Details -->
                        <div id="overlapDetails" style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 0.5rem; padding: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%;"></div>
                                <div style="font-weight: 600; color: #166534; font-size: 0.9375rem;">Outdoor Adventure Enthusiasts</div>
                            </div>
                            <div style="font-size: 0.875rem; color: #166534; line-height: 1.6; margin-bottom: 0.75rem;">
                                <strong>Campaign History:</strong> Ran last week and last month with strong engagement
                            </div>
                            <div style="display: grid; gap: 0.5rem; font-size: 0.8125rem; color: #166534;">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Last Week (Winter Sports Promo):</span>
                                    <strong>35% responded</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Last Month (Holiday Gift Guide):</span>
                                    <strong>52% responded</strong>
                                </div>
                            </div>
                            <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #86efac; font-size: 0.8125rem; color: #166534;">
                                <strong> Recommendation:</strong> Coordinate messaging timing to avoid campaign fatigue. Consider suppressing overlapping users for 2-3 weeks.
                            </div>
                        </div>
                    </div>

                    <!-- Right: Quick Segment List -->
                    <div>
                        <h4 style="font-size: 0.9375rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Quick Select</h4>
                        <div id="segmentOverlapList" style="display: grid; gap: 0.75rem; max-height: 520px; overflow-y: auto; padding-right: 0.5rem;">
                            <div onclick="document.getElementById('overlapSegmentSelector').value='outdoor'; updateOverlapVisualization('outdoor')" data-period="week month" class="overlap-list-item" style="padding: 1rem; background: #f0fdf4; border: 2px solid #86efac; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(16,185,129,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #166534; font-size: 0.875rem; margin-bottom: 0.125rem;">Outdoor Adventures</div>
                                        <div style="font-size: 0.75rem; color: #16a34a;">Last Week + Last Month</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">42%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">5,244 overlap</div>
                                </div>
                            </div>

                            <div onclick="document.getElementById('overlapSegmentSelector').value='winter'; updateOverlapVisualization('winter')" data-period="week" class="overlap-list-item" style="padding: 1rem; background: #faf5ff; border: 2px solid #e9d5ff; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(139,92,246,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #6b21a8; font-size: 0.875rem; margin-bottom: 0.125rem;">Winter Sports Promo</div>
                                        <div style="font-size: 0.75rem; color: #9333ea;">Last Week</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #8b5cf6;">35%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">4,370 overlap</div>
                                </div>
                            </div>

                            <div onclick="document.getElementById('overlapSegmentSelector').value='holiday'; updateOverlapVisualization('holiday')" data-period="month" class="overlap-list-item" style="padding: 1rem; background: #fdf2f8; border: 2px solid #fbcfe8; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(236,72,153,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #9f1239; font-size: 0.875rem; margin-bottom: 0.125rem;">Holiday Gift Guide</div>
                                        <div style="font-size: 0.75rem; color: #ec4899;">Last Month</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #ec4899;">52%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">6,493 overlap</div>
                                </div>
                            </div>

                            <div onclick="document.getElementById('overlapSegmentSelector').value='premium'; updateOverlapVisualization('premium')" data-period="all" class="overlap-list-item" style="padding: 1rem; background: #fffbeb; border: 2px solid #fde68a; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(245,158,11,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #92400e; font-size: 0.875rem; margin-bottom: 0.125rem;">Premium Buyers</div>
                                        <div style="font-size: 0.75rem; color: #f59e0b;">Active</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">28%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">3,496 overlap</div>
                                </div>
                            </div>

                            <div onclick="document.getElementById('overlapSegmentSelector').value='loyalty'; updateOverlapVisualization('loyalty')" data-period="all" class="overlap-list-item" style="padding: 1rem; background: #eff6ff; border: 2px solid #bfdbfe; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(59,130,246,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #1e40af; font-size: 0.875rem; margin-bottom: 0.125rem;">Gold Tier Loyalty</div>
                                        <div style="font-size: 0.75rem; color: #3b82f6;">Active</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;">38%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">4,745 overlap</div>
                                </div>
                            </div>

                            <div onclick="document.getElementById('overlapSegmentSelector').value='recentBuyers'; updateOverlapVisualization('recentBuyers')" data-period="all" class="overlap-list-item" style="padding: 1rem; background: #ecfeff; border: 2px solid #a5f3fc; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px rgba(6,182,212,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.5rem;"></div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #155e75; font-size: 0.875rem; margin-bottom: 0.125rem;">Recent Buyers</div>
                                        <div style="font-size: 0.75rem; color: #06b6d4;">Active (30 Days)</div>
                                    </div>
                                </div>
                                <div style="text-align: center; padding: 0.5rem; background: white; border-radius: 0.375rem;">
                                    <div style="font-size: 1.5rem; font-weight: 700; color: #06b6d4;">22%</div>
                                    <div style="font-size: 0.75rem; color: #6b7280;">2,747 overlap</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(3)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(5)">
                    Next: Channel Affinity
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 7: Activate Segment -->
        <div id="tabContent7" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Activate Your Segment</h2>
                <p class="section-description">Choose an activation template and launch your campaign</p>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;">Segment Summary</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; padding: 1rem; background: #f9fafb; border-radius: 0.375rem;">
                    <div>
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.25rem;">Segment Name</div>
                        <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">High Value Outdoor Enthusiasts</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.25rem;">Audience Size</div>
                        <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">12,487</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.25rem;">Avg. LTV</div>
                        <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">$3,240</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.25rem;">Smart Splits</div>
                        <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">2 Variants (50/50)</div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem;">Select Activation Template</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">Choose a pre-configured template with channels, personalization, and journey orchestration ready to go</p>
                
                <div style="display: grid; gap: 1rem;">
                    <!-- Template 1: Multi-Channel Re-engagement -->
                    <label style="display: block; padding: 1.25rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1d72f3'; this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <input type="radio" name="activation" value="reengagement" checked style="margin-top: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.25rem;"></div>
                                    <div style="font-weight: 600; color: #1f2937;">Multi-Channel Re-engagement</div>
                                    <span style="background: #dbeafe; color: #1e40af; font-size: 0.75rem; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">RECOMMENDED</span>
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.5; margin-bottom: 0.875rem;">
                                    Intelligent cross-channel journey to re-activate dormant customers with personalized incentives and dynamic follow-ups.
                                </div>
                                
                                <!-- Channel Preferences -->
                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Channel Preferences</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Email (Primary)</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> WhatsApp</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Mobile Push</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> SMS (Fallback)</span>
                                    </div>
                                </div>

                                <!-- Personalization Attributes -->
                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Personalization Attributes</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Customer Name</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Last Purchase Date</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Favorite Category</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">LTV Tier</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Loyalty Status</span>
                                    </div>
                                </div>

                                <!-- Journey Orchestration -->
                                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.375rem; padding: 0.875rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; margin-bottom: 0.625rem;"> Journey Orchestration</div>
                                    <div style="font-size: 0.8125rem; color: #0c4a6e; line-height: 1.6;">
                                        <div style="margin-bottom: 0.375rem;">1 Send <strong>Email</strong> with personalized offer  Wait <strong>24 hours</strong></div>
                                        <div style="margin-bottom: 0.375rem;">2 If <strong>Email Opened</strong>  Send <strong>WhatsApp</strong> reminder with cart link</div>
                                        <div style="margin-bottom: 0.375rem;">3 If <strong>WhatsApp Clicked</strong>  Track conversion</div>
                                        <div style="margin-bottom: 0.375rem;">4 If <strong>No Click in 48h</strong>  Activate <strong>Meta Ads</strong> retargeting</div>
                                        <div>5 If <strong>No engagement in 72h</strong>  Send <strong>SMS</strong> with urgency message</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </label>

                    <!-- Template 2: Email + Social Retargeting -->
                    <label style="display: block; padding: 1.25rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1d72f3'; this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <input type="radio" name="activation" value="emailsocial" style="margin-top: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.25rem;"></div>
                                    <div style="font-weight: 600; color: #1f2937;">Email + Social Retargeting</div>
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.5; margin-bottom: 0.875rem;">
                                    Email-first campaign with intelligent social media retargeting for non-engagers.
                                </div>
                                
                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Channel Preferences</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Email (Primary)</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Meta Ads</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Instagram Ads</span>
                                    </div>
                                </div>

                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Personalization Attributes</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Product Recommendations</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Browse History</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Abandoned Cart Items</span>
                                    </div>
                                </div>

                                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.375rem; padding: 0.875rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; margin-bottom: 0.625rem;"> Journey Orchestration</div>
                                    <div style="font-size: 0.8125rem; color: #0c4a6e; line-height: 1.6;">
                                        <div style="margin-bottom: 0.375rem;">1 Send <strong>Email</strong> with product recommendations  Wait <strong>48 hours</strong></div>
                                        <div style="margin-bottom: 0.375rem;">2 If <strong>No Open</strong>  Activate <strong>Meta Custom Audience</strong> with same products</div>
                                        <div>3 If <strong>Ad Clicked</strong>  Send <strong>Follow-up Email</strong> with limited-time offer</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </label>

                    <!-- Template 3: High-Touch VIP Outreach -->
                    <label style="display: block; padding: 1.25rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1d72f3'; this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <input type="radio" name="activation" value="vip" style="margin-top: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.25rem;"></div>
                                    <div style="font-weight: 600; color: #1f2937;">High-Touch VIP Outreach</div>
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.5; margin-bottom: 0.875rem;">
                                    Premium experience for high-value customers with CRM sync and sales team coordination.
                                </div>
                                
                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Channel Preferences</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Salesforce CRM</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Personalized Email</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;"> Account Manager Task</span>
                                    </div>
                                </div>

                                <div style="background: #f9fafb; border-radius: 0.375rem; padding: 0.875rem; margin-bottom: 0.75rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;"> Personalization Attributes</div>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; font-size: 0.8125rem;">
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Account Value</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Purchase History</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">VIP Benefits</span>
                                        <span style="background: white; border: 1px solid #e5e7eb; padding: 0.25rem 0.625rem; border-radius: 0.25rem;">Account Manager Name</span>
                                    </div>
                                </div>

                                <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.375rem; padding: 0.875rem;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; margin-bottom: 0.625rem;"> Journey Orchestration</div>
                                    <div style="font-size: 0.8125rem; color: #0c4a6e; line-height: 1.6;">
                                        <div style="margin-bottom: 0.375rem;">1 Create <strong>Salesforce Opportunity</strong>  Assign to <strong>Account Manager</strong></div>
                                        <div style="margin-bottom: 0.375rem;">2 Send <strong>Premium Email</strong> with exclusive offer  Wait <strong>3 days</strong></div>
                                        <div>3 If <strong>No Response</strong>  Trigger <strong>Manager Follow-up Task</strong> with call script</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </label>

                    <!-- Create Custom Template -->
                    <label style="display: block; padding: 1.25rem; border: 2px dashed #d1d5db; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#1d72f3'; this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.background='white'" onclick="showCustomTemplateConfig()">
                        <div style="display: flex; align-items: start; gap: 1rem;">
                            <input type="radio" name="activation" value="custom" style="margin-top: 0.25rem;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <div style="font-size: 1.25rem;"></div>
                                    <div style="font-weight: 600; color: #1f2937;">Create Custom Template</div>
                                    <span style="background: #fef3c7; color: #92400e; font-size: 0.75rem; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">BUILD YOUR OWN</span>
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280; line-height: 1.5;">
                                    Configure your own channels, personalization attributes, and journey orchestration from scratch. Full flexibility to match your unique needs.
                                </div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Custom Template Configuration (Hidden by default) -->
            <div id="customTemplateConfig" style="display: none; background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                    <button onclick="hideCustomTemplateConfig()" style="background: #f3f4f6; border: none; padding: 0.5rem; border-radius: 0.375rem; cursor: pointer; display: flex; align-items: center;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#374151" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937;">Configure Custom Template</h3>
                        <p style="font-size: 0.875rem; color: #6b7280;">Build your activation template step by step</p>
                    </div>
                </div>

                <!-- Step 1: Select Channels -->
                <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 1.25rem;">
                    <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem;">Step 1: Select Channels</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="email">
                            <span> Email</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="sms">
                            <span> SMS</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="whatsapp">
                            <span> WhatsApp</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="push">
                            <span> Mobile Push</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="metaads">
                            <span> Meta Ads</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="channel" value="crm">
                            <span> Salesforce CRM</span>
                        </label>
                    </div>
                </div>

                <!-- Step 2: Personalization Attributes -->
                <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 1.25rem;">
                    <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem;">Step 2: Add Personalization Attributes</div>
                    
                    <!-- Search and Add Attributes -->
                    <div style="margin-bottom: 1rem;">
                        <div style="position: relative;">
                            <input type="text" id="attributeSearch" placeholder="Search for attributes..." oninput="searchAttributes(this.value)" style="width: 100%; padding: 0.75rem 0.75rem 0.75rem 2.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2" style="position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%);">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="m21 21-4.35-4.35"/>
                            </svg>
                        </div>
                        <div id="attributeSearchResults" style="display: none; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; margin-top: 0.5rem; max-height: 200px; overflow-y: auto;"></div>
                    </div>

                    <!-- Selected Attributes -->
                    <div id="selectedAttributes" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 0.75rem; margin-bottom: 1rem;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="attribute" value="name" checked>
                            <span>Customer Name</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="attribute" value="ltv" checked>
                            <span>LTV Tier</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                            <input type="checkbox" name="attribute" value="loyalty" checked>
                            <span>Loyalty Status</span>
                        </label>
                    </div>

                    <button onclick="showAllAttributes()" style="background: white; border: 1px solid #d1d5db; color: #374151; padding: 0.5rem 1rem; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer;">
                        + Browse All Attributes
                    </button>
                </div>

                <!-- Step 3: Journey Orchestration -->
                <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1.25rem; margin-bottom: 1.25rem;">
                    <div style="font-size: 0.9375rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem;">Step 3: Configure Journey Orchestration</div>
                    <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem;">
                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1rem;">Add suggested steps or define your own custom workflow.</div>
                        
                        <!-- Suggested Steps -->
                        <div style="background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 0.375rem; padding: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.8125rem; font-weight: 600; color: #0c4a6e; margin-bottom: 0.75rem;"> Quick Add Suggested Steps</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <button onclick="addSuggestedStep('email-send')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Send Email
                                </button>
                                <button onclick="addSuggestedStep('wait-24h')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Wait 24 hours
                                </button>
                                <button onclick="addSuggestedStep('check-email-open')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     If Email Opened
                                </button>
                                <button onclick="addSuggestedStep('send-whatsapp')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Send WhatsApp
                                </button>
                                <button onclick="addSuggestedStep('check-click')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     If Clicked
                                </button>
                                <button onclick="addSuggestedStep('activate-meta-ads')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Activate Meta Ads
                                </button>
                                <button onclick="addSuggestedStep('send-sms')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Send SMS
                                </button>
                                <button onclick="addSuggestedStep('sync-crm')" style="background: white; border: 1px solid #93c5fd; color: #1e40af; padding: 0.5rem 0.875rem; border-radius: 0.375rem; font-size: 0.8125rem; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#dbeafe'" onmouseout="this.style.background='white'">
                                     Sync to CRM
                                </button>
                            </div>
                        </div>
                        
                        <!-- Journey Steps -->
                        <div id="journeySteps" style="margin-bottom: 1rem;">
                            <!-- Journey steps will be added here dynamically -->
                            <div style="background: #f9fafb; border: 1px dashed #d1d5db; border-radius: 0.375rem; padding: 1rem; text-align: center; color: #6b7280; font-size: 0.875rem;">
                                No steps added yet. Click a suggested step above or define your own.
                            </div>
                        </div>
                        
                        <button onclick="addCustomJourneyStep()" style="background: #1d72f3; color: white; border: none; padding: 0.625rem 1.25rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 600; cursor: pointer;">
                            + Add Custom Step
                        </button>
                    </div>
                </div>

                <!-- Save Template Button -->
                <div style="display: flex; justify-content: flex-end; gap: 0.75rem;">
                    <button onclick="hideCustomTemplateConfig()" style="background: white; border: 1px solid #d1d5db; color: #374151; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer;">
                        Cancel
                    </button>
                    <button onclick="saveCustomTemplate()" style="background: linear-gradient(135deg, #1d72f3 0%, #1e40af 100%); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.375rem; font-size: 0.9375rem; font-weight: 600; cursor: pointer; box-shadow: 0 2px 4px rgba(29, 114, 243, 0.3);">
                        Save & Use Template
                    </button>
                </div>
            </div>

            <div style="text-align: center; padding: 2rem 0;">
                <button onclick="activateSegment()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; font-size: 1.125rem; font-weight: 600; padding: 1rem 3rem; border: none; border-radius: 0.5rem; cursor: pointer; box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3); transition: all 0.2s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(16, 185, 129, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(16, 185, 129, 0.3)'">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="8 12 12 16 16 12"/>
                            <line x1="12" y1="8" x2="12" y2="16"/>
                        </svg>
                        <span>Activate Segment</span>
                    </div>
                </button>
                <div style="font-size: 0.875rem; color: #6b7280; margin-top: 1rem;">Activation will begin immediately and respect the selected channel send times</div>
            </div>

            <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1.25rem;">
                <div style="display: flex; align-items: start; gap: 0.75rem;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#1d72f3" stroke-width="2" style="flex-shrink: 0; margin-top: 0.125rem;">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    <div style="font-size: 0.875rem; color: #1e40af; line-height: 1.6;">
                        <strong>Pro Tip:</strong> Multi-Channel Campaign template is recommended based on your segment's channel affinity data. This approach leverages the best send times for each channel to maximize engagement.
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(6)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="switchTab(8)">
                    Next: Segment Performance
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Tab 8: Segment Performance -->
        <div id="tabContent8" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">Segment Performance</h2>
                <p class="section-description">Real-time performance metrics and actionable insights</p>
            </div>

            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; padding: 2rem; border-radius: 0.5rem; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 0.9375rem; opacity: 0.9; margin-bottom: 0.5rem;">Segment Status</div>
                        <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;"> Active</div>
                        <div style="font-size: 0.9375rem; opacity: 0.9;">Multi-Channel Campaign  Activated 2 hours ago</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.9375rem; opacity: 0.9; margin-bottom: 0.5rem;">Messages Sent</div>
                        <div style="font-size: 2rem; font-weight: 700;">8,243</div>
                        <div style="font-size: 0.9375rem; opacity: 0.9;">of 12,487 (66%)</div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">Smart Split Performance</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">Compare how each variant is performing in real-time</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 0.5rem; padding: 1.25rem; position: relative;">
                        <div style="position: absolute; top: -10px; right: 1rem; background: #10b981; color: white; font-size: 0.75rem; font-weight: 700; padding: 0.25rem 0.75rem; border-radius: 1rem;">WINNING</div>
                        <div style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;"> Push Discount (Split A)</div>
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Conversion Rate</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #10b981;">18.4%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Engagement Rate</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">42.7%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Revenue Generated</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">$87,420</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Audience Size</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">6,244 (50%)</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 0.5rem; padding: 1.25rem;">
                        <div style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 1rem;"> Email Offer (Split B)</div>
                        <div style="display: grid; gap: 0.75rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Conversion Rate</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #f59e0b;">14.2%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Engagement Rate</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">38.5%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Revenue Generated</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">$68,940</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 0.875rem; color: #6b7280;">Audience Size</span>
                                <span style="font-size: 0.9375rem; font-weight: 600; color: #1f2937;">6,243 (50%)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 0.5rem; padding: 1rem;">
                    <div style="display: flex; align-items: start; gap: 0.5rem;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#92400e" stroke-width="2" style="flex-shrink: 0; margin-top: 0.125rem;">
                            <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                        </svg>
                        <div style="font-size: 0.875rem; color: #92400e;">
                            <strong>Split Recommendation:</strong> Push Discount (Split A) is outperforming by 4.2 percentage points. Consider allocating more budget to this variant or using this strategy for future campaigns.
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;"> Overall Segment Performance</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">How your segment performed across all metrics</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem;">
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.5rem;">Total Conversions</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #10b981;">2,048</div>
                        <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;"> 16.4% conversion rate</div>
                    </div>
                    <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem;">
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.5rem;">Total Revenue</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #1f2937;">$156,360</div>
                        <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;"> $76 avg order value</div>
                    </div>
                    <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem;">
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.5rem;">Engagement Rate</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #1f2937;">40.8%</div>
                        <div style="font-size: 0.75rem; color: #10b981; margin-top: 0.25rem;"> 8.2% above average</div>
                    </div>
                    <div style="background: #f9fafb; border-radius: 0.5rem; padding: 1rem;">
                        <div style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0.5rem;">ROI</div>
                        <div style="font-size: 1.75rem; font-weight: 700; color: #10b981;">4.2x</div>
                        <div style="font-size: 0.75rem; color: #6b7280; margin-top: 0.25rem;">$37,240 campaign cost</div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;"> Performance vs. Past Campaigns</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">See how this segment compares to similar campaigns</p>
                
                <div style="display: grid; gap: 1rem;">
                    <div style="background: #f0fdf4; border: 1px solid #86efac; border-radius: 0.5rem; padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 600; color: #166534; margin-bottom: 0.25rem;"> Outdoor Adventure Campaign (Last Month)</div>
                                <div style="font-size: 0.8125rem; color: #16a34a;">Dec 1-24, 2025  Similar audience profile</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">+24%</div>
                                <div style="font-size: 0.75rem; color: #166534;">Better conversion</div>
                            </div>
                        </div>
                        <div style="font-size: 0.8125rem; color: #166534;">
                            <strong>Comparison:</strong> Your segment achieved 16.4% conversion vs. 13.2% in the Outdoor Adventure campaign. The refined targeting and mobile push strategy drove superior results.
                        </div>
                    </div>

                    <div style="background: #faf5ff; border: 1px solid #e9d5ff; border-radius: 0.5rem; padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 600; color: #6b21a8; margin-bottom: 0.25rem;"> Winter Sports Promo (Last Week)</div>
                                <div style="font-size: 0.8125rem; color: #9333ea;">Jan 13-19, 2026  Different product category</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #8b5cf6;">+12%</div>
                                <div style="font-size: 0.75rem; color: #6b21a8;">Better engagement</div>
                            </div>
                        </div>
                        <div style="font-size: 0.8125rem; color: #6b21a8;">
                            <strong>Comparison:</strong> Engagement rate of 40.8% vs. 36.4% in Winter Sports. Your high-value targeting and personalized messaging resonated better with this premium segment.
                        </div>
                    </div>

                    <div style="background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 0.5rem; padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 600; color: #1e40af; margin-bottom: 0.25rem;"> Average Campaign Performance (Last 6 Months)</div>
                                <div style="font-size: 0.8125rem; color: #3b82f6;">Baseline across all segments</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;">+38%</div>
                                <div style="font-size: 0.75rem; color: #1e40af;">Above average</div>
                            </div>
                        </div>
                        <div style="font-size: 0.8125rem; color: #1e40af;">
                            <strong>Comparison:</strong> Your segment significantly outperformed the 6-month average (11.9% conversion rate). The combination of GRL refinement, smart splits, and optimal channel timing drove exceptional results.
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 1px solid #e5e7eb; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;"> What Could Be Better?</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">AI-powered recommendations to optimize your campaign</p>
                
                <div style="display: grid; gap: 1rem;">
                    <div style="background: #fef2f2; border-left: 4px solid #ef4444; padding: 1rem; border-radius: 0.375rem;">
                        <div style="font-weight: 600; color: #991b1b; margin-bottom: 0.5rem;"> Email Engagement Below Expected</div>
                        <div style="font-size: 0.875rem; color: #7f1d1d; line-height: 1.6; margin-bottom: 0.75rem;">
                            Email open rate (42%) is 8% below your segment's predicted rate (50%). This may be due to send time or subject line.
                        </div>
                        <div style="font-size: 0.8125rem; color: #991b1b;">
                            <strong>Action:</strong> Try sending emails closer to 7:00 PM when this segment is most active, and A/B test subject lines that emphasize exclusivity.
                        </div>
                    </div>

                    <div style="background: #fffbeb; border-left: 4px solid #f59e0b; padding: 1rem; border-radius: 0.375rem;">
                        <div style="font-weight: 600; color: #92400e; margin-bottom: 0.5rem;"> SMS Underutilized</div>
                        <div style="font-size: 0.875rem; color: #78350f; line-height: 1.6; margin-bottom: 0.75rem;">
                            SMS has a 92% affinity score for this segment but only 31% of the audience engaged. Response rate is strong, but reach is limited.
                        </div>
                        <div style="font-size: 0.8125rem; color: #92400e;">
                            <strong>Action:</strong> Increase SMS allocation by 15% in future campaigns. This channel has high potential with this audience.
                        </div>
                    </div>

                    <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; border-radius: 0.375rem;">
                        <div style="font-weight: 600; color: #075985; margin-bottom: 0.5rem;"> Segment Overlap Consideration</div>
                        <div style="font-size: 0.875rem; color: #0c4a6e; line-height: 1.6; margin-bottom: 0.75rem;">
                            52% of this segment received the Holiday Gift Guide campaign last month. Some fatigue may be present in the overlapping audience.
                        </div>
                        <div style="font-size: 0.8125rem; color: #075985;">
                            <strong>Action:</strong> Consider suppressing the 52% overlap group for 1-2 weeks, or create a specialized message for returning customers.
                        </div>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 2px solid #10b981; border-radius: 0.5rem; padding: 1.5rem;">
                <h3 style="font-size: 1.125rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;"> Next Steps</h3>
                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 1.25rem;">Recommended actions to maximize campaign success</p>
                
                <div style="display: grid; gap: 0.875rem;">
                    <div style="display: flex; align-items: start; gap: 0.75rem; padding: 1rem; background: #f9fafb; border-radius: 0.375rem;">
                        <div style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; flex-shrink: 0;">1</div>
                        <div>
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Scale the Winning Split</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Push Discount (Split A) is outperforming. Allocate 70% of future budget to this approach.</div>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; gap: 0.75rem; padding: 1rem; background: #f9fafb; border-radius: 0.375rem;">
                        <div style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; flex-shrink: 0;">2</div>
                        <div>
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Re-engage Non-Responders</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Create a follow-up campaign targeting the 4,244 customers who didn't engage (34%). Try different messaging or channel.</div>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; gap: 0.75rem; padding: 1rem; background: #f9fafb; border-radius: 0.375rem;">
                        <div style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; flex-shrink: 0;">3</div>
                        <div>
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Create a Lookalike Segment</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Build a lookalike audience based on the 2,048 customers who converted. This can expand your high-value audience by ~8,000-10,000.</div>
                        </div>
                    </div>

                    <div style="display: flex; align-items: start; gap: 0.75rem; padding: 1rem; background: #f9fafb; border-radius: 0.375rem;">
                        <div style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.875rem; flex-shrink: 0;">4</div>
                        <div>
                            <div style="font-weight: 600; color: #1f2937; margin-bottom: 0.25rem;">Optimize Send Times</div>
                            <div style="font-size: 0.875rem; color: #6b7280;">Shift email sends to 6:30-7:00 PM window when this segment shows peak engagement. Expected lift: +6-8% open rate.</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn-nav btn-nav-secondary" onclick="switchTab(7)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Previous
                </button>
                <button class="btn-nav btn-nav-primary" onclick="alert('Campaign performance data saved!')">
                    Export Results
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 0;
        let currentAudience = 12487;
        let addedFilters = [];

        // Agentic conversation variables
        let selectedGoal = '';
        let followupAnswers = {};
        let currentQuestionIndex = 0;
        let goalQuestionFlow = [];

        // Sophisticated question flows for each goal
        const goalQuestionFlows = {
            'Churn Prevention': {
                questions: [
                    {
                        text: 'What does churn mean for you?',
                        options: [
                            { label: 'Subscription cancellation', value: 'subscription' },
                            { label: 'No purchase in last N days', value: 'no_purchase' },
                            { label: 'No product usage in last N days', value: 'no_usage' },
                            { label: 'Custom definition', value: 'custom' }
                        ]
                    },
                    {
                        text: 'What do you mean by likely to respond?',
                        options: [
                            { label: 'Use existing Response Propensity score', value: 'propensity_score' },
                            { label: 'Use proxies: past engagement + recent activity', value: 'proxies' },
                            { label: 'Custom', value: 'custom' }
                        ]
                    },
                    {
                        text: 'Any exclusions or constraints?',
                        options: [
                            { label: 'Exclude contacted in last 7 days', value: 'exclude_recent' },
                            { label: 'Respect consent / do-not-contact', value: 'respect_consent' },
                            { label: 'Exclude already in retention journey', value: 'exclude_journey' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (Precision-Focused)',
                        description: 'High LTV + churn risk + high response likelihood',
                        details: 'Smaller audience, better ROI',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Reach-Focused)',
                        description: 'Medium+ LTV + churn risk + medium response likelihood',
                        details: 'Larger audience, lower precision',
                        icon: ''
                    }
                ]
            },
            'Win-back': {
                questions: [
                    {
                        text: 'How do you define "churned"?',
                        options: [
                            { label: 'No purchase in 60+ days', value: '60_days' },
                            { label: 'No purchase in 90+ days', value: '90_days' },
                            { label: 'Subscription canceled', value: 'subscription_canceled' },
                            { label: 'Custom timeframe', value: 'custom' }
                        ]
                    },
                    {
                        text: 'What incentive will you offer?',
                        options: [
                            { label: 'Discount (10-30%)', value: 'discount' },
                            { label: 'Free gift / bonus', value: 'gift' },
                            { label: 'Loyalty points', value: 'loyalty' },
                            { label: 'Free shipping', value: 'free_shipping' }
                        ]
                    },
                    {
                        text: 'Which customers to prioritize?',
                        options: [
                            { label: 'High historical value', value: 'high_value' },
                            { label: 'Recent churners (< 90 days)', value: 'recent' },
                            { label: 'High engagement before churn', value: 'engaged' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (High-Value Focus)',
                        description: 'Top 20% LTV + recently churned + high past engagement',
                        details: 'Smaller segment, highest recovery potential',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Broad Win-back)',
                        description: 'Medium+ LTV + churned 30-90 days + any engagement',
                        details: 'Larger segment, moderate recovery rate',
                        icon: ''
                    }
                ]
            },
            'Growth & Monetization': {
                questions: [
                    {
                        text: 'What product/category are you promoting?',
                        options: [
                            { label: 'Premium tier upgrade', value: 'premium_upgrade' },
                            { label: 'Add-on products', value: 'addons' },
                            { label: 'Bundle/package', value: 'bundle' },
                            { label: 'New product line', value: 'new_product' }
                        ]
                    },
                    {
                        text: 'How do you measure "share of wallet"?',
                        options: [
                            { label: 'Purchase frequency increase', value: 'frequency' },
                            { label: 'Average order value growth', value: 'aov' },
                            { label: 'Product category expansion', value: 'categories' }
                        ]
                    },
                    {
                        text: 'Target customers based on?',
                        options: [
                            { label: 'High purchase frequency', value: 'frequency' },
                            { label: 'High average order value', value: 'aov' },
                            { label: 'Product affinity match', value: 'affinity' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (High-Intent Upsell)',
                        description: 'Frequent buyers + high AOV + product affinity',
                        details: 'Highest conversion potential',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Growth Opportunity)',
                        description: 'Medium frequency + growth potential + category fit',
                        details: 'Larger audience, expansion focus',
                        icon: ''
                    }
                ]
            },
            'Acquisition': {
                questions: [
                    {
                        text: 'Define "best customers" for lookalike?',
                        options: [
                            { label: 'Top 10% LTV', value: 'top_ltv' },
                            { label: 'Most frequent buyers', value: 'frequent' },
                            { label: 'High engagement + purchases', value: 'engaged' },
                            { label: 'Custom criteria', value: 'custom' }
                        ]
                    },
                    {
                        text: 'Which attributes to match on?',
                        options: [
                            { label: 'Demographics (age, location, income)', value: 'demographics' },
                            { label: 'Behaviors (browsing, engagement)', value: 'behaviors' },
                            { label: 'Both demographics + behaviors', value: 'both' }
                        ]
                    },
                    {
                        text: 'Audience size preference?',
                        options: [
                            { label: 'Tight match (1-2% similarity)', value: 'tight' },
                            { label: 'Moderate (2-5% similarity)', value: 'moderate' },
                            { label: 'Broad (5-10% similarity)', value: 'broad' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (High-Quality Match)',
                        description: 'Top 5% LTV lookalikes + tight demographic match',
                        details: 'Smaller audience, highest quality',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Scale Acquisition)',
                        description: 'Top 20% LTV lookalikes + moderate match',
                        details: 'Larger pool, good quality/scale balance',
                        icon: ''
                    }
                ]
            },
            'Service Led Marketing': {
                questions: [
                    {
                        text: 'How do you identify "frustrated" customers?',
                        options: [
                            { label: 'Recent support case opened', value: 'case_opened' },
                            { label: 'Low satisfaction score', value: 'low_satisfaction' },
                            { label: 'Multiple cases in 30 days', value: 'multiple_cases' },
                            { label: 'Custom criteria', value: 'custom' }
                        ]
                    },
                    {
                        text: 'What action will you take?',
                        options: [
                            { label: 'Proactive support outreach', value: 'support' },
                            { label: 'Goodwill discount/credit', value: 'compensation' },
                            { label: 'Premium service upgrade', value: 'upgrade' }
                        ]
                    },
                    {
                        text: 'Timing preference?',
                        options: [
                            { label: 'Immediate (within 24 hrs)', value: 'immediate' },
                            { label: 'After case resolution', value: 'after_resolution' },
                            { label: 'Custom timing', value: 'custom' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (High-Risk Intervention)',
                        description: 'Multiple cases + low satisfaction + high value',
                        details: 'Immediate action, prevent churn',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Proactive Care)',
                        description: 'Recent case + medium value + early intervention',
                        details: 'Broader care, relationship building',
                        icon: ''
                    }
                ]
            },
            'Cross-sell & Upsell': {
                questions: [
                    {
                        text: 'Which products to recommend?',
                        options: [
                            { label: 'Based on purchase history', value: 'history' },
                            { label: 'Based on browsing behavior', value: 'browsing' },
                            { label: 'Best-selling complementary items', value: 'bestsellers' },
                            { label: 'AI-recommended bundles', value: 'ai_bundles' }
                        ]
                    },
                    {
                        text: 'Target customers based on?',
                        options: [
                            { label: 'Recent purchasers (< 30 days)', value: 'recent' },
                            { label: 'Repeat buyers', value: 'repeat' },
                            { label: 'High lifetime value', value: 'high_ltv' }
                        ]
                    },
                    {
                        text: 'Promotion strategy?',
                        options: [
                            { label: 'Bundle discount', value: 'bundle_discount' },
                            { label: 'Free shipping on add-ons', value: 'free_shipping' },
                            { label: 'Loyalty points bonus', value: 'loyalty_bonus' }
                        ]
                    }
                ],
                strategies: [
                    {
                        name: 'Strategy A (AI-Optimized)',
                        description: 'High LTV + AI product recommendations + recent activity',
                        details: 'Highest conversion probability',
                        icon: ''
                    },
                    {
                        name: 'Strategy B (Proven Winners)',
                        description: 'Repeat buyers + best-selling combos + bundle offers',
                        details: 'Larger volume, proven success',
                        icon: ''
                    }
                ]
            }
        };

        // Dynamic questions based on goal
        const goalQuestions = {
            'Re-engage dormant customers': {
                q1: {
                    text: 'How long has it been since their last purchase?',
                    options: [
                        { emoji: '', text: '30-90 days', value: '30-90 days' },
                        { emoji: '', text: '3-6 months', value: '3-6 months' },
                        { emoji: '', text: '6-12 months', value: '6-12 months' },
                        { emoji: '', text: '1+ year', value: '1+ year' }
                    ]
                },
                q2: {
                    text: 'What incentive would work best?',
                    options: [
                        { emoji: '', text: 'Discount offer', value: 'Discount offer' },
                        { emoji: '', text: 'Free gift', value: 'Free gift' },
                        { emoji: '', text: 'Loyalty points', value: 'Loyalty points' },
                        { emoji: '', text: 'Free shipping', value: 'Free shipping' }
                    ]
                }
            },
            'Target high-value customers': {
                q1: {
                    text: 'How do you define "high-value" for this campaign?',
                    options: [
                        { emoji: '', text: 'Top 10% spenders', value: 'Top 10% spenders' },
                        { emoji: '', text: 'Lifetime value >$1K', value: 'High LTV' },
                        { emoji: '', text: 'Frequent buyers', value: 'Frequent buyers' },
                        { emoji: '', text: 'Premium product buyers', value: 'Premium buyers' }
                    ]
                },
                q2: {
                    text: 'What type of exclusive offer are you planning?',
                    options: [
                        { emoji: '', text: 'Early access', value: 'Early access' },
                        { emoji: '', text: 'VIP discount', value: 'VIP discount' },
                        { emoji: '', text: 'Limited edition', value: 'Limited edition' },
                        { emoji: '', text: 'Upgrade benefits', value: 'Upgrade benefits' }
                    ]
                }
            },
            'Welcome new customers': {
                q1: {
                    text: 'How recently did they join?',
                    options: [
                        { emoji: '', text: 'Last 7 days', value: 'Last 7 days' },
                        { emoji: '', text: 'Last 30 days', value: 'Last 30 days' },
                        { emoji: '', text: 'Last 60 days', value: 'Last 60 days' },
                        { emoji: '', text: 'Last 90 days', value: 'Last 90 days' }
                    ]
                },
                q2: {
                    text: 'What\'s your primary onboarding goal?',
                    options: [
                        { emoji: '', text: 'First purchase', value: 'First purchase' },
                        { emoji: '', text: 'App download', value: 'App download' },
                        { emoji: '', text: 'Profile completion', value: 'Profile completion' },
                        { emoji: '', text: 'Engagement', value: 'Engagement' }
                    ]
                }
            },
            'Promote seasonal campaign': {
                q1: {
                    text: 'Which season or event are you targeting?',
                    options: [
                        { emoji: '', text: 'Winter/Holiday', value: 'Winter' },
                        { emoji: '', text: 'Spring', value: 'Spring' },
                        { emoji: '', text: 'Summer', value: 'Summer' },
                        { emoji: '', text: 'Fall/Back-to-School', value: 'Fall' }
                    ]
                },
                q2: {
                    text: 'How urgent is this campaign?',
                    options: [
                        { emoji: '', text: 'Flash sale (24-48h)', value: 'Flash sale' },
                        { emoji: '', text: 'Weekend promo', value: 'Weekend promo' },
                        { emoji: '', text: 'Week-long', value: 'Week-long' },
                        { emoji: '', text: 'Month-long', value: 'Month-long' }
                    ]
                }
            },
            'Upsell to existing customers': {
                q1: {
                    text: 'What product tier are you upselling to?',
                    options: [
                        { emoji: '', text: 'Next tier up', value: 'Next tier' },
                        { emoji: '', text: 'Premium tier', value: 'Premium tier' },
                        { emoji: '', text: 'Bundle/Package', value: 'Bundle' },
                        { emoji: '', text: 'Add-ons', value: 'Add-ons' }
                    ]
                },
                q2: {
                    text: 'Based on what customer behavior?',
                    options: [
                        { emoji: '', text: 'Repeat purchases', value: 'Repeat purchases' },
                        { emoji: '', text: 'Product views', value: 'Product views' },
                        { emoji: '', text: 'High spend', value: 'High spend' },
                        { emoji: '', text: 'Product ratings', value: 'Engagement' }
                    ]
                }
            },
            'Reduce churn risk': {
                q1: {
                    text: 'What signals indicate churn risk?',
                    options: [
                        { emoji: '', text: 'Declining activity', value: 'Declining activity' },
                        { emoji: '', text: 'No recent login', value: 'No login' },
                        { emoji: '', text: 'Abandoned carts', value: 'Abandoned carts' },
                        { emoji: '', text: 'Cancellation intent', value: 'Cancel intent' }
                    ]
                },
                q2: {
                    text: 'What retention strategy will you use?',
                    options: [
                        { emoji: '', text: 'Win-back discount', value: 'Discount' },
                        { emoji: '', text: 'Personal outreach', value: 'Outreach' },
                        { emoji: '', text: 'Surprise gift', value: 'Gift' },
                        { emoji: '', text: 'Value reminder', value: 'Value reminder' }
                    ]
                }
            },
            'default': {
                q1: {
                    text: 'What\'s your primary success metric for this segment?',
                    options: [
                        { emoji: '', text: 'Conversions', value: 'Increase conversions' },
                        { emoji: '', text: 'Engagement', value: 'Boost engagement' },
                        { emoji: '', text: 'Retention', value: 'Improve retention' },
                        { emoji: '', text: 'Revenue', value: 'Grow revenue' }
                    ]
                },
                q2: {
                    text: 'What timeframe should I focus on?',
                    options: [
                        { emoji: '', text: '30 days', value: 'Last 30 days' },
                        { emoji: '', text: '90 days', value: 'Last 90 days' },
                        { emoji: '', text: '6 months', value: 'Last 6 months' },
                        { emoji: '', text: '1 year+', value: 'Last year' }
                    ]
                }
            }
        };

        function selectGoal(goalTitle) {
            selectedGoal = goalTitle;
            showFollowupQuestions();
        }

        function startWithCustomGoal() {
            const customInput = document.getElementById('customGoalInput');
            const goal = customInput.value.trim();
            
            if (!goal) {
                alert('Please enter your goal');
                return;
            }
            
            selectedGoal = goal;
            
            // Analyze custom goal and map to appropriate flow
            const detectedGoal = detectGoalIntent(goal);
            if (detectedGoal && goalQuestionFlows[detectedGoal]) {
                // Use detected goal's question flow but keep original custom text
                const originalGoal = selectedGoal;
                selectedGoal = detectedGoal;
                showFollowupQuestions();
                // Restore original custom goal text for display
                document.getElementById('userGoalText').textContent = originalGoal;
            } else {
                // No specific flow detected - proceed directly
                showFollowupQuestions();
            }
        }

        function detectGoalIntent(goalText) {
            const lowerGoal = goalText.toLowerCase();
            
            // Churn/retention keywords
            if (lowerGoal.includes('churn') || lowerGoal.includes('retention') || lowerGoal.includes('at risk') || lowerGoal.includes('at-risk')) {
                return 'Churn Prevention';
            }
            
            // Win-back keywords
            if (lowerGoal.includes('win back') || lowerGoal.includes('winback') || lowerGoal.includes('churned') || lowerGoal.includes('lapsed')) {
                return 'Win-back';
            }
            
            // Growth/monetization keywords
            if (lowerGoal.includes('share of wallet') || lowerGoal.includes('monetization') || lowerGoal.includes('increase revenue from existing')) {
                return 'Growth & Monetization';
            }
            
            // Acquisition keywords
            if (lowerGoal.includes('acquisition') || lowerGoal.includes('lookalike') || lowerGoal.includes('similar to best') || lowerGoal.includes('prospect')) {
                return 'Acquisition';
            }
            
            // Service keywords
            if (lowerGoal.includes('service') || lowerGoal.includes('frustrated') || lowerGoal.includes('support case') || lowerGoal.includes('satisfaction')) {
                return 'Service Led Marketing';
            }
            
            // Upsell/cross-sell keywords
            if (lowerGoal.includes('upsell') || lowerGoal.includes('cross-sell') || lowerGoal.includes('cross sell') || lowerGoal.includes('additional products')) {
                return 'Cross-sell & Upsell';
            }
            
            // Default to Churn Prevention if contains customer targeting language
            if (lowerGoal.includes('target customers') || lowerGoal.includes('prioritize')) {
                return 'Churn Prevention';
            }
            
            return null;
        }

        function showFollowupQuestions() {
            document.getElementById('goalSelectionView').style.display = 'none';
            const followupView = document.getElementById('followupView');
            followupView.style.display = 'block';
            
            // Clear any previous content
            const dynamicQuestion = document.getElementById('dynamicQuestion');
            const strategiesContainer = document.getElementById('strategiesContainer');
            dynamicQuestion.innerHTML = '';
            dynamicQuestion.style.display = 'none';
            strategiesContainer.innerHTML = '';
            strategiesContainer.style.display = 'none';
            
            // Get question flow for this goal
            const flow = goalQuestionFlows[selectedGoal];
            if (!flow) {
                // If no custom flow, proceed directly to segment
                proceedToSegment();
                return;
            }
            
            goalQuestionFlow = flow.questions;
            currentQuestionIndex = 0;
            followupAnswers = {};
            
            // Show user's selected goal
            document.getElementById('userGoalText').textContent = selectedGoal;
            document.getElementById('userGoalMessage').style.display = 'flex';
            
            // Agent acknowledges after a short delay
            setTimeout(() => {
                document.getElementById('agentAck').style.display = 'flex';
                
                // Show first question after another delay
                setTimeout(() => {
                    showNextQuestion();
                }, 600);
            }, 400);
        }

        function showNextQuestion() {
            if (currentQuestionIndex >= goalQuestionFlow.length) {
                // All questions answered - show strategies
                showStrategies();
                return;
            }
            
            const question = goalQuestionFlow[currentQuestionIndex];
            const questionElement = document.getElementById('dynamicQuestion');
            
            // Make container visible
            questionElement.style.display = 'block';
            
            // Build options HTML with A, B, C, D labels
            const optionsHTML = question.options.map((opt, index) => {
                const label = String.fromCharCode(65 + index); // A, B, C, D...
                return `<button class="chat-option" onclick="answerDynamicQuestion('${opt.value}', '${opt.label.replace(/'/g, "\\'")}')">
                    ${label}) ${opt.label}
                </button>`;
            }).join('');
            
            // Create new question message element
            const newQuestionHTML = `
                <div class="chat-message" id="question${currentQuestionIndex}">
                    <div class="chat-avatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                    </div>
                    <div class="chat-bubble">
                        <div class="chat-bubble-text">${question.text}</div>
                        <div class="chat-options" id="questionOptions${currentQuestionIndex}">
                            ${optionsHTML}
                        </div>
                    </div>
                </div>
            `;
            
            // Append new question (don't replace existing content)
            questionElement.insertAdjacentHTML('beforeend', newQuestionHTML);
            
            // Scroll to bottom
            setTimeout(() => {
                const followupView = document.getElementById('followupView');
                followupView.scrollTop = followupView.scrollHeight;
            }, 100);
        }

        function answerDynamicQuestion(value, label) {
            // Store answer
            followupAnswers[`question${currentQuestionIndex}`] = { value, label };
            
            // Hide the options for this question
            const optionsContainer = document.getElementById(`questionOptions${currentQuestionIndex}`);
            if (optionsContainer) {
                optionsContainer.style.display = 'none';
            }
            
            // Show user's answer in same format
            const userAnswerHTML = `
                <div class="chat-message user-message">
                    <div class="chat-bubble">
                        <div class="chat-bubble-text">${label}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('dynamicQuestion').insertAdjacentHTML('beforeend', userAnswerHTML);
            
            // Move to next question
            currentQuestionIndex++;
            
            setTimeout(() => {
                showNextQuestion();
                // Scroll to bottom
                const followupView = document.getElementById('followupView');
                followupView.scrollTop = followupView.scrollHeight;
            }, 600);
        }

        function showStrategies() {
            const flow = goalQuestionFlows[selectedGoal];
            const strategies = flow.strategies;
            
            // Show agent message introducing strategies
            const strategiesContainer = document.getElementById('strategiesContainer');
            strategiesContainer.innerHTML = `
                <div class="chat-message">
                    <div class="chat-avatar">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                    </div>
                    <div class="chat-bubble">
                        <div class="chat-bubble-text">Based on your answers, I've prepared two strategies for you to choose from:</div>
                    </div>
                </div>
                
                <div class="strategies-grid">
                    ${strategies.map((strategy, index) => `
                        <div class="strategy-card" onclick="selectStrategy(${index})">
                            <div class="strategy-icon">${strategy.icon}</div>
                            <div class="strategy-name">${strategy.name}</div>
                            <div class="strategy-description">${strategy.description}</div>
                            <div class="strategy-details">${strategy.details}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            strategiesContainer.style.display = 'block';
            
            // Scroll to bottom
            setTimeout(() => {
                const followupView = document.getElementById('followupView');
                followupView.scrollTop = followupView.scrollHeight;
            }, 100);
        }

        function selectStrategy(strategyIndex) {
            const flow = goalQuestionFlows[selectedGoal];
            const strategy = flow.strategies[strategyIndex];
            
            // Hide all strategy cards
            const strategyCards = document.querySelectorAll('.strategy-card');
            strategyCards.forEach(card => card.style.display = 'none');
            
            // Show user's selection
            const confirmHTML = `
                <div class="chat-message user-message">
                    <div class="chat-bubble">
                        <div class="chat-bubble-text">${strategy.name}</div>
                    </div>
                </div>
            `;
            document.getElementById('strategiesContainer').insertAdjacentHTML('beforeend', confirmHTML);
            
            // Agent confirms and proceeds
            setTimeout(() => {
                const agentConfirmHTML = `
                    <div class="chat-message">
                        <div class="chat-avatar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                            </svg>
                        </div>
                        <div class="chat-bubble">
                            <div class="chat-bubble-text">Perfect! Building your segment using ${strategy.name}... </div>
                        </div>
                    </div>
                `;
                document.getElementById('strategiesContainer').insertAdjacentHTML('beforeend', agentConfirmHTML);
                
                // Scroll to bottom
                const followupView = document.getElementById('followupView');
                followupView.scrollTop = followupView.scrollHeight;
                
                setTimeout(() => {
                    proceedToSegment();
                }, 1500);
            }, 400);
        }

        function proceedToSegment() {
            // Hide welcome state
            document.getElementById('welcomeState').style.display = 'none';
            
            // Show toolbar and tab navigation
            document.getElementById('segmentToolbar').style.display = 'flex';
            document.getElementById('tabNavigation').style.display = 'flex';
            
            // Show first tab
            document.getElementById('tabContent0').classList.add('active');
            
            // Show global agent bar
            document.getElementById('globalAgentBar').classList.add('active');
            
            // Switch to first tab
            switchTab(0);
        }

        function startSegment(event) {
            event.preventDefault();
            const goal = document.getElementById('goalInput').value;
            
            // Keep segment name as is
            
            // Hide welcome
            document.getElementById('welcomeState').style.display = 'none';
            
            // Show toolbar and tab navigation
            document.getElementById('segmentToolbar').style.display = 'flex';
            document.getElementById('tabNavigation').style.display = 'flex';
            
            // Show global agent bar
            document.getElementById('globalAgentBar').classList.add('active');
            
            // Show first tab
            document.getElementById('tabContent0').classList.add('active');
            
            // Switch to first tab
            switchTab(0);
        }

        function switchTab(index) {
            // Hide all tabs (0 through 8 = 9 tabs total)
            for (let i = 0; i <= 8; i++) {
                const tabContent = document.getElementById('tabContent' + i);
                const tab = document.getElementById('tab' + i);
                if (tabContent) tabContent.classList.remove('active');
                if (tab) tab.classList.remove('active');
            }
            
            // Show selected tab
            document.getElementById('tabContent' + index).classList.add('active');
            document.getElementById('tab' + index).classList.add('active');
            
            currentTab = index;
            agentState.currentTab = index;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function activateSegment() {
            // Show success message
            alert('Segment activated successfully! Viewing performance data...');
            // Go to performance tab
            switchTab(8);
        }

        function showCustomTemplateConfig() {
            document.getElementById('customTemplateConfig').style.display = 'block';
            // Scroll to the config section
            document.getElementById('customTemplateConfig').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function hideCustomTemplateConfig() {
            document.getElementById('customTemplateConfig').style.display = 'none';
        }

        // Available attributes for search
        const availableAttributes = [
            'Customer Name', 'Email Address', 'Phone Number', 'LTV Tier', 'Loyalty Status', 
            'Favorite Category', 'Last Purchase Date', 'Product Recommendations', 'Browse History',
            'Abandoned Cart Items', 'Total Orders', 'Average Order Value', 'Preferred Channel',
            'Age', 'Gender', 'Location', 'Zip Code', 'Account Manager Name', 'Account Value',
            'Subscription Status', 'VIP Benefits', 'Purchase History', 'Wishlist Items',
            'Engagement Score', 'Churn Risk', 'Next Best Action', 'Customer Segment'
        ];

        function searchAttributes(query) {
            const searchResults = document.getElementById('attributeSearchResults');
            
            if (!query || query.trim() === '') {
                searchResults.style.display = 'none';
                return;
            }

            const filtered = availableAttributes.filter(attr => 
                attr.toLowerCase().includes(query.toLowerCase())
            );

            if (filtered.length === 0) {
                searchResults.innerHTML = '<div style="padding: 1rem; text-align: center; color: #6b7280; font-size: 0.875rem;">No attributes found</div>';
                searchResults.style.display = 'block';
                return;
            }

            const resultsHTML = filtered.map(attr => `
                <div onclick="addAttribute('${attr}')" style="padding: 0.75rem; border-bottom: 1px solid #f3f4f6; cursor: pointer; font-size: 0.875rem; transition: background 0.2s;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                    ${attr}
                </div>
            `).join('');

            searchResults.innerHTML = resultsHTML;
            searchResults.style.display = 'block';
        }

        function addAttribute(attributeName) {
            const container = document.getElementById('selectedAttributes');
            const value = attributeName.toLowerCase().replace(/\s+/g, '-');
            
            // Check if already added
            const existing = container.querySelector(`input[value="${value}"]`);
            if (existing) {
                document.getElementById('attributeSearch').value = '';
                document.getElementById('attributeSearchResults').style.display = 'none';
                return;
            }

            const attrHTML = `
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer;">
                    <input type="checkbox" name="attribute" value="${value}" checked>
                    <span>${attributeName}</span>
                </label>
            `;

            container.insertAdjacentHTML('beforeend', attrHTML);
            document.getElementById('attributeSearch').value = '';
            document.getElementById('attributeSearchResults').style.display = 'none';
        }

        function showAllAttributes() {
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            
            const content = `
                <div style="background: white; border-radius: 0.75rem; padding: 2rem; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.25rem; font-weight: 600; color: #1f2937;">All Available Attributes</h3>
                        <button onclick="this.closest('[style*=fixed]').remove()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;">
                        ${availableAttributes.map(attr => `
                            <div onclick="addAttribute('${attr}'); this.closest('[style*=fixed]').remove();" style="padding: 0.875rem; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 0.375rem; cursor: pointer; font-size: 0.875rem; transition: all 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f9fafb'">
                                ${attr}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            modal.innerHTML = content;
            document.body.appendChild(modal);
        }

        // Journey Step Management
        let journeyStepCount = 0;

        const suggestedSteps = {
            'email-send': { action: 'Send Message', channel: 'Email', description: 'Send personalized email' },
            'wait-24h': { action: 'Wait Duration', channel: 'N/A', description: 'Wait 24 hours', duration: '24 hours' },
            'check-email-open': { action: 'Branch (If/Else)', channel: 'Email', description: 'Check if email was opened', condition: 'If email opened' },
            'send-whatsapp': { action: 'Send Message', channel: 'WhatsApp', description: 'Send WhatsApp message' },
            'check-click': { action: 'Branch (If/Else)', channel: 'All', description: 'Check if link was clicked', condition: 'If clicked' },
            'activate-meta-ads': { action: 'Sync to Platform', channel: 'Meta Ads', description: 'Activate Meta Ads retargeting' },
            'send-sms': { action: 'Send Message', channel: 'SMS', description: 'Send SMS message' },
            'sync-crm': { action: 'Sync to Platform', channel: 'Salesforce CRM', description: 'Sync to CRM and create task' }
        };

        function addSuggestedStep(stepType) {
            journeyStepCount++;
            const stepsContainer = document.getElementById('journeySteps');
            
            // Remove empty state if it exists
            if (journeyStepCount === 1) {
                stepsContainer.innerHTML = '';
            }

            const step = suggestedSteps[stepType];
            const stepHTML = `
                <div id="step-${journeyStepCount}" style="background: #f0f9ff; border: 1px solid #93c5fd; border-radius: 0.375rem; padding: 1rem; margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.5rem;">
                                Step ${journeyStepCount}: ${step.description}
                            </div>
                            <div style="display: flex; gap: 1rem; font-size: 0.8125rem; color: #1e40af;">
                                <span><strong>Action:</strong> ${step.action}</span>
                                <span><strong>Channel:</strong> ${step.channel}</span>
                                ${step.condition ? `<span><strong>Condition:</strong> ${step.condition}</span>` : ''}
                                ${step.duration ? `<span><strong>Duration:</strong> ${step.duration}</span>` : ''}
                            </div>
                        </div>
                        <button onclick="removeJourneyStep(${journeyStepCount})" style="background: #fee2e2; color: #991b1b; border: none; padding: 0.375rem 0.75rem; border-radius: 0.25rem; font-size: 0.75rem; cursor: pointer;">Remove</button>
                    </div>
                </div>
            `;
            
            stepsContainer.insertAdjacentHTML('beforeend', stepHTML);
        }

        function addCustomJourneyStep() {
            journeyStepCount++;
            const stepsContainer = document.getElementById('journeySteps');
            
            // Remove empty state if it exists
            if (journeyStepCount === 1) {
                stepsContainer.innerHTML = '';
            }
            
            const stepHTML = `
                <div id="step-${journeyStepCount}" style="background: white; border: 1px solid #e5e7eb; border-radius: 0.375rem; padding: 1rem; margin-bottom: 0.75rem;">
                    <div style="display: flex; justify-content: between; align-items: start; gap: 1rem;">
                        <div style="flex: 1;">
                            <div style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.75rem;">
                                Step ${journeyStepCount}
                                <button onclick="removeJourneyStep(${journeyStepCount})" style="float: right; background: #fee2e2; color: #991b1b; border: none; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; cursor: pointer;">Remove</button>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 0.75rem;">
                                <div>
                                    <label style="font-size: 0.75rem; color: #6b7280; display: block; margin-bottom: 0.375rem;">Action Type</label>
                                    <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                        <option>Send Message</option>
                                        <option>Wait for Event</option>
                                        <option>Wait Duration</option>
                                        <option>Branch (If/Else)</option>
                                        <option>Sync to Platform</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="font-size: 0.75rem; color: #6b7280; display: block; margin-bottom: 0.375rem;">Channel/Platform</label>
                                    <select style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                                        <option>Email</option>
                                        <option>SMS</option>
                                        <option>WhatsApp</option>
                                        <option>Mobile Push</option>
                                        <option>Meta Ads</option>
                                        <option>Salesforce CRM</option>
                                        <option>Marketing Cloud</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 0.75rem;">
                                <label style="font-size: 0.75rem; color: #6b7280; display: block; margin-bottom: 0.375rem;">Condition/Trigger (Optional)</label>
                                <input type="text" placeholder="e.g., If email opened, If no click in 24h" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                            </div>
                            
                            <div>
                                <label style="font-size: 0.75rem; color: #6b7280; display: block; margin-bottom: 0.375rem;">Wait Duration (Optional)</label>
                                <input type="text" placeholder="e.g., 24 hours, 48 hours, 3 days" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 0.875rem;">
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            stepsContainer.insertAdjacentHTML('beforeend', stepHTML);
        }

        function removeJourneyStep(stepId) {
            const step = document.getElementById(`step-${stepId}`);
            if (step) {
                step.remove();
                journeyStepCount--;
                
                // Show empty state if no steps left
                if (journeyStepCount === 0) {
                    document.getElementById('journeySteps').innerHTML = '<div style="background: #f9fafb; border: 1px dashed #d1d5db; border-radius: 0.375rem; padding: 1rem; text-align: center; color: #6b7280; font-size: 0.875rem;">No steps added yet. Click "Add Step" below to start building your journey.</div>';
                }
            }
        }

        function saveCustomTemplate() {
            alert('Custom template saved successfully! You can now activate your segment with this template.');
            hideCustomTemplateConfig();
            
            // Optionally scroll back to activation button
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // Create template from agent natural language input
        function createTemplateFromAgent(input) {
            // Show custom template config
            showCustomTemplateConfig();
            
            const inputLower = input.toLowerCase();
            
            // Extract channels from input
            const channelKeywords = {
                'email': ['email', 'mail'],
                'sms': ['sms', 'text'],
                'whatsapp': ['whatsapp', 'wa'],
                'push': ['push', 'push notification', 'mobile push'],
                'metaads': ['meta', 'facebook', 'fb', 'instagram', 'ig', 'social'],
                'crm': ['crm', 'salesforce', 'sales']
            };
            
            // Extract attributes from input
            const attributeKeywords = {
                'Customer Name': ['name', 'customer name'],
                'LTV Tier': ['ltv', 'lifetime value', 'value tier'],
                'Loyalty Status': ['loyalty', 'loyalty status'],
                'Favorite Category': ['category', 'favorite', 'preference'],
                'Product Recommendations': ['product', 'recommendation', 'suggest'],
                'Last Purchase Date': ['last purchase', 'purchase date', 'recent purchase']
            };
            
            // Auto-check channels
            Object.entries(channelKeywords).forEach(([channel, keywords]) => {
                const checkbox = document.querySelector(`input[name="channel"][value="${channel}"]`);
                if (checkbox && keywords.some(kw => inputLower.includes(kw))) {
                    checkbox.checked = true;
                }
            });
            
            // Auto-add attributes
            Object.entries(attributeKeywords).forEach(([attr, keywords]) => {
                if (keywords.some(kw => inputLower.includes(kw))) {
                    addAttribute(attr);
                }
            });
            
            // Parse journey flow intelligently
            parseAndBuildJourney(inputLower);
            
            // Scroll to the config section
            setTimeout(() => {
                document.getElementById('customTemplateConfig').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 200);
        }

        function parseAndBuildJourney(inputLower) {
            // Remove all existing journey steps first
            journeyStepCount = 0;
            document.getElementById('journeySteps').innerHTML = '<div style="background: #f9fafb; border: 1px dashed #d1d5db; border-radius: 0.375rem; padding: 1rem; text-align: center; color: #6b7280; font-size: 0.875rem;">No steps added yet.</div>';
            
            // Tokenize the input into meaningful chunks
            // Replace common separators with a consistent one
            let normalized = inputLower
                .replace(/,/g, ' then ')
                .replace(/\band\b/g, ' then ')
                .replace(/\bafter that\b/g, ' then ')
                .replace(/\bafterwards\b/g, ' then ');
            
            // Split by sequence indicators
            const parts = normalized.split(/\s+then\s+/);
            
            // Process each part
            parts.forEach((part, index) => {
                part = part.trim();
                
                // Check for conditionals: "if X send Y"
                const conditionalMatch = part.match(/if\s+(not\s+)?(opened?|clicked?)\s+send\s+(\w+)/);
                if (conditionalMatch) {
                    const isNegative = !!conditionalMatch[1];
                    const condition = conditionalMatch[2];
                    const channel = conditionalMatch[3];
                    
                    // Add the condition check step
                    if (condition.includes('open')) {
                        addSuggestedStep('check-email-open');
                    } else if (condition.includes('click')) {
                        addSuggestedStep('check-click');
                    }
                    
                    // Add the action step
                    if (channel.includes('whatsapp') || channel.includes('wa')) {
                        addSuggestedStep('send-whatsapp');
                    } else if (channel.includes('sms')) {
                        addSuggestedStep('send-sms');
                    } else if (channel.includes('email')) {
                        addSuggestedStep('email-send');
                    } else if (channel.includes('push')) {
                        addSuggestedStep('send-sms'); // Using SMS as placeholder for push
                    }
                    return;
                }
                
                // Check for "if not" patterns: "if not opened wait X and send Y"
                const ifNotMatch = part.match(/if\s+not\s+(opened?|clicked?)\s+wait\s+.*?(\d+)\s*(hour|day|hr)s?\s+.*?send\s+(\w+)/);
                if (ifNotMatch) {
                    const condition = ifNotMatch[1];
                    const duration = ifNotMatch[2];
                    const unit = ifNotMatch[3];
                    const channel = ifNotMatch[4];
                    
                    // Add condition check
                    if (condition.includes('open')) {
                        addSuggestedStep('check-email-open');
                    } else if (condition.includes('click')) {
                        addSuggestedStep('check-click');
                    }
                    
                    // Add wait step
                    addSuggestedStep('wait-24h');
                    
                    // Add send step
                    if (channel.includes('push')) {
                        addSuggestedStep('send-sms'); // Placeholder
                    } else if (channel.includes('whatsapp')) {
                        addSuggestedStep('send-whatsapp');
                    } else if (channel.includes('sms')) {
                        addSuggestedStep('send-sms');
                    } else if (channel.includes('email')) {
                        addSuggestedStep('email-send');
                    }
                    return;
                }
                
                // Simple action patterns
                // Send email
                if (part.includes('send email') || part.includes('email')) {
                    addSuggestedStep('email-send');
                }
                
                // Wait patterns
                if (part.match(/wait\s+(\d+)\s*(hour|day|hr)s?/)) {
                    addSuggestedStep('wait-24h');
                }
                
                // Send WhatsApp
                if (part.includes('whatsapp') || part.includes('wa')) {
                    addSuggestedStep('send-whatsapp');
                }
                
                // Send SMS
                if (part.includes('sms') || part.includes('text message')) {
                    addSuggestedStep('send-sms');
                }
                
                // Send Push
                if (part.includes('push notification') || part.includes('mobile push') || part.includes('send push')) {
                    addSuggestedStep('send-sms'); // Using SMS as placeholder
                }
                
                // Activate Meta Ads
                if (part.includes('meta') || part.includes('facebook') || part.includes('ads')) {
                    addSuggestedStep('activate-meta-ads');
                }
                
                // Sync CRM
                if (part.includes('crm') || part.includes('salesforce')) {
                    addSuggestedStep('sync-crm');
                }
                
                // Check if opened
                if (part.match(/if\s+(opened?|email opened?)/)) {
                    addSuggestedStep('check-email-open');
                }
                
                // Check if clicked
                if (part.match(/if\s+(clicked?|link clicked?)/)) {
                    addSuggestedStep('check-click');
                }
            });
        }

        function toggleOverlapDetails(id) {
            const detailsDiv = document.getElementById(id + '-details');
            if (detailsDiv.style.display === 'none' || detailsDiv.style.display === '') {
                detailsDiv.style.display = 'block';
            } else {
                detailsDiv.style.display = 'none';
            }
        }

        function updateOverlapVisualization(segmentType) {
            const data = {
                outdoor: {
                    name: 'Outdoor\nAdventures',
                    count: '18,245',
                    overlap: '42%',
                    overlapCount: '5,244',
                    color: '#10b981',
                    bgColor: '#f0fdf4',
                    borderColor: '#86efac',
                    textColor: '#166534',
                    history: 'Ran last week and last month with strong engagement',
                    details: [
                        { label: 'Last Week (Winter Sports Promo):', value: '35% responded' },
                        { label: 'Last Month (Holiday Gift Guide):', value: '52% responded' }
                    ],
                    recommendation: 'Coordinate messaging timing to avoid campaign fatigue. Consider suppressing overlapping users for 2-3 weeks.'
                },
                premium: {
                    name: 'Premium\nBuyers',
                    count: '9,832',
                    overlap: '28%',
                    overlapCount: '3,496',
                    color: '#f59e0b',
                    bgColor: '#fffbeb',
                    borderColor: '#fde68a',
                    textColor: '#92400e',
                    history: 'Active segment with high purchasing power',
                    details: [
                        { label: 'Average purchase value:', value: '$485 (35% above avg)' },
                        { label: 'Loyalty tier:', value: 'Mostly Gold/Platinum' }
                    ],
                    recommendation: 'Prioritize exclusive product launches and VIP experiences for this high-value overlap.'
                },
                winter: {
                    name: 'Winter\nSports',
                    count: '14,620',
                    overlap: '35%',
                    overlapCount: '4,370',
                    color: '#8b5cf6',
                    bgColor: '#faf5ff',
                    borderColor: '#e9d5ff',
                    textColor: '#6b21a8',
                    history: 'Campaign ran Jan 13-19, 2026 (Last Week)',
                    details: [
                        { label: 'Response rate:', value: '18.2% (above average)' },
                        { label: 'Campaign ROI:', value: '$124K revenue' }
                    ],
                    recommendation: 'Wait 2-3 weeks before next outreach. High engagement suggests strong sports equipment interest.'
                },
                holiday: {
                    name: 'Holiday\nGift Guide',
                    count: '21,340',
                    overlap: '52%',
                    overlapCount: '6,493',
                    color: '#ec4899',
                    bgColor: '#fdf2f8',
                    borderColor: '#fbcfe8',
                    textColor: '#9f1239',
                    history: 'Campaign ran Dec 1-24, 2025 (Last Month)',
                    details: [
                        { label: 'Conversion rate:', value: '14.8% (excellent)' },
                        { label: 'Average order value:', value: '$287' }
                    ],
                    recommendation: 'Strong seasonal responsiveness. Leverage gift-giving occasions and holiday themes for this audience.'
                },
                loyalty: {
                    name: 'Gold Tier\nLoyalty',
                    count: '15,420',
                    overlap: '38%',
                    overlapCount: '4,745',
                    color: '#3b82f6',
                    bgColor: '#eff6ff',
                    borderColor: '#bfdbfe',
                    textColor: '#1e40af',
                    history: 'Active loyalty program members',
                    details: [
                        { label: 'Average tenure:', value: '3.2 years' },
                        { label: 'Points balance:', value: 'Avg 8,420 points' }
                    ],
                    recommendation: 'Leverage loyalty rewards and exclusive member benefits to drive engagement and retention.'
                },
                recentBuyers: {
                    name: 'Recent\nBuyers',
                    count: '7,892',
                    overlap: '22%',
                    overlapCount: '2,747',
                    color: '#06b6d4',
                    bgColor: '#ecfeff',
                    borderColor: '#a5f3fc',
                    textColor: '#155e75',
                    history: 'Purchased within last 30 days',
                    details: [
                        { label: 'Purchase recency:', value: 'Avg 12 days ago' },
                        { label: 'Repeat purchase rate:', value: '34%' }
                    ],
                    recommendation: 'Target with complementary products and accessories. High conversion potential for cross-sell.'
                }
            };

            const segment = data[segmentType];
            
            // Update comparison label in Venn diagram
            const labelLines = segment.name.split('\n');
            document.getElementById('vennCompareLabel').innerHTML = `
                <tspan x="300" dy="-10">${labelLines[0]}</tspan>
                <tspan x="300" dy="20">${labelLines[1]}</tspan>
                <tspan x="300" dy="20" font-size="20" font-weight="700">${segment.count}</tspan>
            `;
            
            // Update right circle color
            document.getElementById('vennCircle2').setAttribute('fill', segment.color);
            document.getElementById('vennCircle2').setAttribute('fill-opacity', '0.3');
            document.getElementById('vennCircle2').setAttribute('stroke', segment.color);
            
            // Update overlap text
            const overlapText = document.querySelectorAll('#vennCircle1 ~ text')[2];
            if (overlapText) {
                overlapText.innerHTML = `
                    <tspan x="200" dy="-10">Overlap</tspan>
                    <tspan x="200" dy="25" font-size="24">${segment.overlap}</tspan>
                    <tspan x="200" dy="25" font-size="14" font-weight="600">${segment.overlapCount}</tspan>
                `;
            }
            
            // Update details box
            let detailsHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <div style="width: 12px; height: 12px; background: ${segment.color}; border-radius: 50%;"></div>
                    <div style="font-weight: 600; color: ${segment.textColor}; font-size: 0.9375rem;">${segment.name.replace('\n', ' ')}</div>
                </div>
                <div style="font-size: 0.875rem; color: ${segment.textColor}; line-height: 1.6; margin-bottom: 0.75rem;">
                    <strong>Campaign History:</strong> ${segment.history}
                </div>
                <div style="display: grid; gap: 0.5rem; font-size: 0.8125rem; color: ${segment.textColor};">
            `;
            
            segment.details.forEach(detail => {
                detailsHTML += `
                    <div style="display: flex; justify-content: space-between;">
                        <span>${detail.label}</span>
                        <strong>${detail.value}</strong>
                    </div>
                `;
            });
            
            detailsHTML += `
                </div>
                <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid ${segment.borderColor}; font-size: 0.8125rem; color: ${segment.textColor};">
                    <strong> Recommendation:</strong> ${segment.recommendation}
                </div>
            `;
            
            document.getElementById('overlapDetails').innerHTML = detailsHTML;
            document.getElementById('overlapDetails').style.background = segment.bgColor;
            document.getElementById('overlapDetails').style.borderColor = segment.borderColor;
        }

        function filterOverlapSegments(period) {
            // Update button states
            document.getElementById('filterWeek').style.background = period === 'week' ? '#1d72f3' : 'white';
            document.getElementById('filterWeek').style.color = period === 'week' ? 'white' : '#6b7280';
            document.getElementById('filterWeek').style.borderColor = period === 'week' ? '#1d72f3' : '#d1d5db';
            
            document.getElementById('filterMonth').style.background = period === 'month' ? '#1d72f3' : 'white';
            document.getElementById('filterMonth').style.color = period === 'month' ? 'white' : '#6b7280';
            document.getElementById('filterMonth').style.borderColor = period === 'month' ? '#1d72f3' : '#d1d5db';
            
            document.getElementById('filterAll').style.background = period === 'all' ? '#1d72f3' : 'white';
            document.getElementById('filterAll').style.color = period === 'all' ? 'white' : '#6b7280';
            document.getElementById('filterAll').style.borderColor = period === 'all' ? '#1d72f3' : '#d1d5db';

            // Filter list items
            const listItems = document.querySelectorAll('.overlap-list-item');
            const selectOptions = document.querySelectorAll('#overlapSegmentSelector option');
            
            listItems.forEach(item => {
                const itemPeriod = item.getAttribute('data-period');
                if (period === 'all' || itemPeriod.includes(period)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            // Filter dropdown options
            selectOptions.forEach(option => {
                const optionPeriod = option.getAttribute('data-period');
                if (period === 'all' || optionPeriod.includes(period)) {
                    option.style.display = 'block';
                } else {
                    option.style.display = 'none';
                }
            });

            // Select first visible option
            const firstVisible = Array.from(selectOptions).find(opt => opt.style.display !== 'none');
            if (firstVisible) {
                document.getElementById('overlapSegmentSelector').value = firstVisible.value;
                updateOverlapVisualization(firstVisible.value);
            }
        }

        let exclusionMode = false;

        function toggleQuickFilters() {
            const panel = document.getElementById('quickFiltersPanel');
            const arrow = document.getElementById('triggerArrow');
            exclusionMode = false;
            
            if (panel.classList.contains('open')) {
                panel.classList.remove('open');
                arrow.classList.remove('open');
            } else {
                panel.classList.add('open');
                arrow.classList.add('open');
            }
        }

        function toggleQuickFiltersForExclusion() {
            const panel = document.getElementById('quickFiltersPanel');
            const arrow = document.getElementById('triggerArrow');
            exclusionMode = true;
            
            panel.classList.add('open');
            arrow.classList.add('open');
            
            // Update panel title to indicate exclusion mode
            const title = panel.querySelector('.quick-filters-title');
            const originalTitle = title.textContent;
            title.textContent = 'Select Filters to Exclude';
            title.style.color = '#6b7280';
            
            // Reset on close
            setTimeout(() => {
                const observer = new MutationObserver(() => {
                    if (!panel.classList.contains('open')) {
                        title.textContent = 'Select from Quick Filters to Refine Segment';
                        title.style.color = '';
                        exclusionMode = false;
                        observer.disconnect();
                    }
                });
                observer.observe(panel, { attributes: true, attributeFilter: ['class'] });
            }, 100);
        }

        function addQuickFilter(name, icon, isExclusion = false) {
            if (addedFilters.includes(name)) {
                toggleQuickFilters();
                return;
            }
            
            addedFilters.push(name);
            
            if (isExclusion) {
                // Add to exclusion list
                const excludesList = document.getElementById('excludesList');
                
                const newExclude = document.createElement('div');
                newExclude.className = 'exclude-card';
                newExclude.innerHTML = `
                    <div class="exclude-content">
                        <span class="exclude-text"><strong>${name.split(':')[0]}</strong> is <strong>${name.split(':')[1]}</strong></span>
                    </div>
                    <div class="exclude-actions">
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                            </svg>
                        </button>
                    </div>
                `;
                
                excludesList.appendChild(newExclude);
            } else {
                // Get filters column
                const filtersColumn = document.getElementById('filtersColumn');
                
                // Create new filter card
                const newFilter = document.createElement('div');
                newFilter.className = 'filter-card';
                newFilter.innerHTML = `
                    <div class="filter-content">
                        <span class="filter-text"><strong>${name.split(':')[0]}</strong> is equal to <strong>${name.split(':')[1]}</strong></span>
                    </div>
                    <div class="filter-actions">
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                            </svg>
                        </button>
                        <button class="icon-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </button>
                </div>
                `;
                filtersColumn.appendChild(newFilter);
            }
            
            // The AND slab automatically spans all filters, no need to update it
            
            // Update audience count
            currentAudience -= 1500;
            updateAudienceDisplay();
            
            // Close panel
            if (exclusionMode) {
                toggleQuickFiltersForExclusion();
            } else {
                toggleQuickFilters();
            }
        }

        function updateAudienceDisplay() {
            // Update final audience in Save & Activate tab
            const finalAudience = document.getElementById('finalAudience');
            if (finalAudience) {
                finalAudience.textContent = currentAudience.toLocaleString();
            }
            
            // Update toolbar audience count
            const toolbarAudienceElement = document.getElementById('toolbarAudienceCount');
            if (toolbarAudienceElement) {
                toolbarAudienceElement.textContent = currentAudience.toLocaleString();
            }
        }

        function updateDistributionChart(attribute) {
            console.log('Switching distribution chart to:', attribute);
            // In a real implementation, this would update the charts based on selected attribute
            // For now, it just logs the selection
        }

        function updateSplit(value) {
            const percentA = parseInt(value);
            const percentB = 100 - percentA;
            
            document.getElementById('splitA').textContent = percentA;
            document.getElementById('splitB').textContent = percentB;
            document.getElementById('splitACard').textContent = percentA;
            document.getElementById('splitBCard').textContent = percentB;
            
            const audienceA = Math.floor(currentAudience * percentA / 100);
            const audienceB = currentAudience - audienceA;
            
            document.getElementById('audienceA').textContent = audienceA.toLocaleString();
            document.getElementById('audienceB').textContent = audienceB.toLocaleString();
            
            // Update slider gradient
            const slider = document.getElementById('splitSlider');
            slider.style.background = `linear-gradient(to right, #1d72f3 0%, #1d72f3 ${percentA}%, #10b981 ${percentA}%, #10b981 100%)`;
        }

        function resetSplit() {
            document.getElementById('splitSlider').value = 50;
            updateSplit(50);
        }

        // Close quick filters when clicking outside
        document.addEventListener('click', function(event) {
            const trigger = event.target.closest('.quick-filters-trigger');
            const panel = document.getElementById('quickFiltersPanel');
            const arrow = document.getElementById('triggerArrow');
            
            if (!trigger && !event.target.closest('.quick-filters-panel') && panel.classList.contains('open')) {
                panel.classList.remove('open');
                arrow.classList.remove('open');
            }
        });

        // ========================================
        // GLOBAL AGENTIC COMMAND BAR
        // ========================================

        // Global agent state
        const agentState = {
            currentTab: 0,
            pendingAction: null,
            isProcessing: false,
            chatHistory: [],
            isExpanded: true,
            awaitingConfirmation: false,
            pendingActionData: null
        };

        // Comprehensive action database - maps natural language to UI actions
        const actionDatabase = {
            // SEGMENT DEFINITION TAB (0)
            segmentDefinition: {
                tab: 0,
                name: 'Segment Definition',
                keywords: ['filter', 'segment', 'attribute', 'definition', 'criteria', 'add', 'include', 'exclude'],
                actions: {
                    'age': { 
                        patterns: ['age', 'age group', 'age range', '25-45', 'age 25', 'older', 'younger'],
                        execute: () => addQuickFilter('Age 25-45', 'age'),
                        confirm: 'add Age 25-45 filter'
                    },
                    'gender_female': { 
                        patterns: ['female', 'women', 'woman', 'she', 'her'],
                        execute: () => addQuickFilter('Female', 'gender'),
                        confirm: 'add Female gender filter'
                    },
                    'gender_male': { 
                        patterns: ['male', 'men', 'man', 'he', 'him'],
                        execute: () => addQuickFilter('Male', 'gender'),
                        confirm: 'add Male gender filter'
                    },
                    'ltv': { 
                        patterns: ['high ltv', 'lifetime value', 'high value', 'ltv', 'valuable', 'high spending'],
                        execute: () => addQuickFilter('High LTV', 'value'),
                        confirm: 'add High LTV filter'
                    },
                    'premium': { 
                        patterns: ['premium', 'premium tier', 'premium customer', 'vip', 'top tier'],
                        execute: () => addQuickFilter('Premium Tier', 'tier'),
                        confirm: 'add Premium Tier filter'
                    },
                    'active': { 
                        patterns: ['active', 'active status', 'active customer', 'engaged'],
                        execute: () => addQuickFilter('Active Status', 'status'),
                        confirm: 'add Active Status filter'
                    },
                    'email_opted': { 
                        patterns: ['email', 'email opted', 'opted in', 'email preference', 'subscribed'],
                        execute: () => addQuickFilter('Email Opted In', 'preference'),
                        confirm: 'add Email Opted In filter'
                    },
                    'recent_purchase': { 
                        patterns: ['recent purchase', 'recent buy', 'recently bought', 'recent activity'],
                        execute: () => addQuickFilter('Recent Purchase', 'behavior'),
                        confirm: 'add Recent Purchase filter'
                    },
                    'location': { 
                        patterns: ['location', 'region', 'geography', 'area', 'city', 'state'],
                        execute: () => addQuickFilter('US Region', 'location'),
                        confirm: 'add US Region filter'
                    },
                    'income': { 
                        patterns: ['income', 'salary', 'earnings', 'high income', 'wealthy'],
                        execute: () => addQuickFilter('High Income', 'income'),
                        confirm: 'add High Income filter'
                    },
                    'loyalty': { 
                        patterns: ['loyalty', 'loyal', 'repeat', 'frequent buyer', 'returning'],
                        execute: () => addQuickFilter('Loyalty Member', 'loyalty'),
                        confirm: 'add Loyalty Member filter'
                    },
                    'outdoor': { 
                        patterns: ['outdoor', 'hiking', 'camping', 'nature', 'adventure'],
                        execute: () => addQuickFilter('Outdoor Enthusiast', 'interest'),
                        confirm: 'add Outdoor Enthusiast filter'
                    },
                    // Exclusion filters
                    'exclude_contacted': { 
                        patterns: ['exclude contacted', 'exclude recent contact', 'not contacted', 'exclude 7 days', 'exclude last week'],
                        execute: () => addQuickFilter('Contact Recency: less than 7 days', 'exclusion', true),
                        confirm: 'exclude customers contacted in last 7 days'
                    },
                    'exclude_age': { 
                        patterns: ['exclude age', 'exclude young', 'exclude old', 'not age'],
                        execute: () => addQuickFilter('Age Group: Under 25', 'exclusion', true),
                        confirm: 'exclude Age Group Under 25'
                    },
                    'exclude_device': { 
                        patterns: ['exclude mobile', 'exclude device', 'not mobile', 'exclude desktop'],
                        execute: () => addQuickFilter('Device: Mobile', 'exclusion', true),
                        confirm: 'exclude Mobile device users'
                    },
                    'exclude_region': { 
                        patterns: ['exclude region', 'exclude location', 'not in region', 'exclude area'],
                        execute: () => addQuickFilter('Region: Specific Area', 'exclusion', true),
                        confirm: 'exclude specific region'
                    }
                }
            },

            // RANK AND LIMIT TAB (1)
            rankLimit: {
                tab: 1,
                name: 'Rank and Limit',
                keywords: ['rank', 'limit', 'group', 'grl', 'top', 'prioritize', 'sort', 'order'],
                actions: {
                    'explain': {
                        patterns: ['explain', 'what is', 'how does', 'help', 'info', 'tell me about'],
                        execute: () => {},
                        respond: 'Rank and Limit lets you prioritize your segment. Group by attributes, rank by metrics (like LTV or recency), and set a limit on how many customers to target.'
                    },
                    'set_limit': {
                        patterns: ['set limit', 'limit to', 'top 1000', 'top 5000', 'limit 500', 'restrict to'],
                        execute: () => {},
                        respond: 'You can set the limit using the Limit field. Try values like 500, 1000, or 5000 depending on your campaign size.'
                    }
                }
            },

            // SEGMENT PREVIEW TAB (2)
            segmentPreview: {
                tab: 2,
                name: 'Segment Preview',
                keywords: ['preview', 'sample', 'records', 'data', 'view', 'show data', 'records', 'population'],
                actions: {
                    'view_records': {
                        patterns: ['show records', 'view data', 'see sample', 'preview data', 'show population'],
                        execute: () => {},
                        respond: 'Here you can see a sample of 50 records from your segment, along with key insights like average LTV, total spend, and demographic breakdowns.'
                    }
                }
            },

            // SEGMENT INSIGHTS TAB (3)
            segmentInsights: {
                tab: 3,
                name: 'Segment Insights',
                keywords: ['insights', 'analysis', 'composition', 'risk', 'behavior', 'impact', 'overview', 'metrics'],
                actions: {
                    'view_insights': {
                        patterns: ['show insights', 'view analysis', 'see composition', 'show metrics', 'overview'],
                        execute: () => {},
                        respond: 'This tab shows comprehensive insights including audience composition, risk distribution, churn scores, overlap analysis, and projected business impact of your segment.'
                    }
                }
            },

            // OVERLAP ANALYSIS TAB (4)
            overlapAnalysis: {
                tab: 4,
                name: 'Overlap Analysis',
                keywords: ['overlap', 'overlap analysis', 'segment overlap', 'common', 'intersection', 'shared', 'venn'],
                actions: {
                    'view_overlap': {
                        patterns: ['show overlap', 'view overlap', 'see overlap', 'overlap with', 'compare segments'],
                        execute: () => {},
                        respond: 'You can compare your segment with other active and historical segments to see how much overlap exists. Use the dropdown to select which segment to compare with.'
                    }
                }
            },

            // CHANNEL AFFINITY TAB (5)
            channelAffinity: {
                tab: 5,
                name: 'Channel Affinity',
                keywords: ['channel', 'affinity', 'email', 'sms', 'push', 'in-app', 'notification', 'message', 'contact'],
                actions: {
                    'view': {
                        patterns: ['show', 'view', 'see', 'display', 'what are', 'channel preference'],
                        execute: () => {},
                        respond: 'Here you can see which channels your segment prefers: Email (45%), SMS (22%), Push (15%), and In-App (18%). Each channel also shows the best time to send.'
                    },
                    'best_time': {
                        patterns: ['best time', 'when to send', 'optimal time', 'timing', 'schedule'],
                        execute: () => {},
                        respond: 'The best times to reach this segment are: Email (6-8 PM), SMS (10 AM-12 PM), Push (7-9 PM), and In-App (12-2 PM).'
                    }
                }
            },

            // SMART SPLITS TAB (6)
            smartSplits: {
                tab: 6,
                name: 'Smart Splits',
                keywords: ['split', 'variant', 'test', 'a/b', 'control', 'experiment', 'version'],
                actions: {
                    'add_split': {
                        patterns: ['add split', 'create split', 'new split', 'add variant', 'another split'],
                        execute: () => {
                            const splits = document.querySelectorAll('.split-card').length;
                            if (splits < 4) {
                                alert('Click the "+ Add Split" button to create a new variant');
                            }
                        },
                        respond: 'Click the "+ Add Split" button below to create a new test variant. You can have up to 4 splits for thorough testing.'
                    },
                    'explain': {
                        patterns: ['explain', 'why split', 'what is', 'how does', 'benefit', 'why use'],
                        execute: () => {},
                        respond: 'Smart Splits let you A/B test different approaches with your segment. Test different messages, offers, or channels to see what works best before rolling out to everyone.'
                    }
                }
            },

            // ACTIVATE TAB (7)
            activate: {
                tab: 7,
                name: 'Activate',
                keywords: ['activate', 'launch', 'deploy', 'send', 'start campaign', 'go live', 'create template', 'template', 'journey', 'workflow'],
                actions: {
                    'activate_segment': {
                        patterns: ['activate', 'launch', 'start', 'deploy', 'go live', 'send campaign'],
                        execute: () => {},
                        respond: 'Select an activation template and click "Activate Segment" to launch your campaign. You can choose multi-channel, email-only, or custom workflows.'
                    },
                    'create_template': {
                        patterns: [
                            'create template', 'build template', 'new template', 'custom template', 'make template',
                            'send email', 'send sms', 'send whatsapp', 'send push',
                            'if opened', 'if clicked', 'if not',
                            'journey', 'workflow', 'set up journey', 'configure journey'
                        ],
                        execute: (input) => {
                            // Create template - always delay slightly for UI responsiveness
                            setTimeout(() => createTemplateFromAgent(input || ''), 300);
                        },
                        confirm: 'create a custom template',
                        respond: 'Creating a custom template for you based on your journey...'
                    }
                }
            },

            // SEGMENT PERFORMANCE TAB (8)
            segmentPerformance: {
                tab: 8,
                name: 'Segment Performance',
                keywords: ['performance', 'results', 'metrics', 'success', 'roi', 'conversion', 'engagement'],
                actions: {
                    'view_results': {
                        patterns: ['show results', 'view performance', 'see metrics', 'how did it perform', 'results'],
                        execute: () => {
                            setTimeout(() => {
                                const overlapSection = document.querySelector('.overlap-section');
                                if (overlapSection) {
                                    overlapSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                            }, 300);
                        },
                        respond: 'Here\'s the segment overlap analysis showing how your segment intersects with other segments.'
                    },
                    'demographics': {
                        patterns: ['demographic', 'demographics', 'gender', 'age', 'profile', 'audience'],
                        execute: () => {
                            setTimeout(() => {
                                const insightsGrid = document.querySelector('.insights-grid');
                                if (insightsGrid) {
                                    insightsGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }, 300);
                        },
                        respond: 'Here are the demographic insights for your segment including gender ratio, age distribution, and reachable audience.'
                    },
                    'reach': {
                        patterns: ['reach', 'reachable', 'audience size', 'how many', 'size'],
                        execute: () => {},
                        respond: 'Your segment has a total reachable audience shown in the insights cards above. Check "Total Reachable" for the exact count.'
                    }
                }
            },

            // ACTIVATE TAB (5)
            activate: {
                tab: 5,
                name: 'Activate',
                keywords: ['activate', 'launch', 'deploy', 'template', 'start', 'begin', 'go live'],
                actions: {
                    'template': {
                        patterns: ['template', 'select template', 'choose template', 'activation template', 'use template'],
                        execute: () => {},
                        respond: 'Select an activation template from the dropdown above. Templates include Email Campaign, Multi-Channel Journey, and SMS Blast options.'
                    },
                    'launch': {
                        patterns: ['launch', 'activate', 'start', 'go', 'deploy', 'begin'],
                        execute: () => {},
                        respond: 'Once you\'ve selected a template, click the "Activate Segment" button to launch your campaign.'
                    }
                }
            },

            // SEGMENT PERFORMANCE TAB (6)
            performance: {
                tab: 6,
                name: 'Segment Performance',
                keywords: ['performance', 'results', 'metrics', 'stats', 'how did', 'success', 'outcome'],
                actions: {
                    'view': {
                        patterns: ['show', 'view', 'see', 'results', 'how did', 'performance'],
                        execute: () => {},
                        respond: 'Here are the performance metrics for your segment including engagement rates, conversion rates, and ROI across all splits.'
                    },
                    'recommendations': {
                        patterns: ['recommend', 'suggestion', 'next steps', 'what next', 'improve', 'optimize'],
                        execute: () => {
                            setTimeout(() => {
                                const recommendations = document.querySelector('.recommendations-section');
                                if (recommendations) {
                                    recommendations.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                }
                            }, 300);
                        },
                        respond: 'Here are AI-powered recommendations to optimize your segment based on performance data.'
                    }
                }
            }
        };

        function processAgentCommand(command) {
            if (agentState.isProcessing) return;
            agentState.isProcessing = true;

            const lowerCommand = command.toLowerCase().trim();
            
            // Check if we're awaiting a confirmation
            if (agentState.awaitingConfirmation) {
                handleConfirmationResponse(lowerCommand);
                agentState.isProcessing = false;
                return;
            }
            
            // Add user message to chat history
            addChatMessage('user', command);
            
            // First, try to find the best matching action across ALL tabs
            const match = findBestActionMatch(lowerCommand);
            
            if (!match) {
                // No match found - provide helpful suggestion
                const suggestion = "I'm not sure what you mean. Try: 'Show overlap analysis', 'Add age filter', 'Go to Smart Splits', or 'Explain rank and limit'";
                addChatMessage('agent', suggestion);
                showChatExpansion();
                agentState.isProcessing = false;
                return;
            }

            // Store original command in match for actions that need it
            match.originalCommand = command;

            // Check if action belongs to current tab or needs navigation
            if (match.tab !== agentState.currentTab) {
                // CROSS-TAB: Ask for confirmation in chat
                const message = `I can ${match.action.confirm || 'help with that'} in the ${match.tabConfig.name} tab. Would you like me to take you there?`;
                addChatMessage('agent', message, ['Yes, take me there', 'No thanks', 'Stay here']);
                
                // Store pending action
                agentState.awaitingConfirmation = true;
                agentState.pendingActionData = {
                    type: 'cross-tab',
                    match: match
                };
                
                showChatExpansion();
            } else {
                // SAME-TAB: Check if needs confirmation
                const needsConfirmation = match.action.execute.toString().includes('addQuickFilter');
                const isTemplateCreation = match.action.execute.toString().includes('createTemplateFromAgent');
                
                if (needsConfirmation) {
                    // Filter addition - ask confirmation
                    const confirmMsg = `Would you like me to ${match.action.confirm}?`;
                    addChatMessage('agent', confirmMsg, ['Yes, do it', 'No thanks', 'Add different filter']);
                    
                    // Store pending action
                    agentState.awaitingConfirmation = true;
                    agentState.pendingActionData = {
                        type: 'same-tab-action',
                        match: match
                    };
                    
                    showChatExpansion();
                } else {
                    // Direct execution (info/view commands and template creation)
                    if (match.action.respond) {
                        addChatMessage('agent', match.action.respond);
                    }
                    executeActionWithChat(match);
                    
                    // For template creation, add follow-up message
                    if (isTemplateCreation) {
                        setTimeout(() => {
                            addChatMessage('agent', 'I\'ve set up a template based on your journey. Review the steps, channels, and attributes, then click "Save & Use Template" when ready!');
                        }, 500);
                    }
                    
                    showChatExpansion();
                }
            }
            
            agentState.isProcessing = false;
        }

        function handleConfirmationResponse(response) {
            // Add user's response to chat
            addChatMessage('user', response);
            
            // Check for positive confirmation
            const isPositive = /^(yes|yeah|yep|sure|ok|okay|confirm|do it|go ahead|proceed|take me|switch)/.test(response);
            const isNegative = /^(no|nope|nah|cancel|stop|dont|don't|stay|never mind|nevermind)/.test(response);
            
            if (isPositive) {
                const pendingData = agentState.pendingActionData;
                
                if (pendingData.type === 'cross-tab') {
                    // Execute cross-tab navigation
                    addChatMessage('agent', `Taking you to ${pendingData.match.tabConfig.name}...`);
                    setTimeout(() => {
                        switchTab(pendingData.match.tab);
                        setTimeout(() => {
                            executeActionWithChat(pendingData.match);
                            addChatMessage('agent', ' Done!');
                        }, 400);
                    }, 300);
                } else if (pendingData.type === 'same-tab-action') {
                    // Execute same-tab action
                    executeActionWithChat(pendingData.match);
                    addChatMessage('agent', ' Done!');
                }
                
                // Reset confirmation state
                agentState.awaitingConfirmation = false;
                agentState.pendingActionData = null;
                
            } else if (isNegative) {
                addChatMessage('agent', 'No problem! Let me know if you need anything else.');
                
                // Reset confirmation state
                agentState.awaitingConfirmation = false;
                agentState.pendingActionData = null;
            } else {
                // Unclear response - ask again
                addChatMessage('agent', 'I didn\'t quite catch that. Please type "yes" to confirm or "no" to cancel.', ['Yes', 'No']);
            }
        }

        function addChatMessage(sender, message, suggestions = []) {
            agentState.chatHistory.push({ sender, message, suggestions, timestamp: Date.now() });
            
            // Keep only last 20 messages
            if (agentState.chatHistory.length > 20) {
                agentState.chatHistory.shift();
            }
            
            renderChatMessages();
        }

        function renderChatMessages() {
            const messagesContainer = document.getElementById('agentChatMessages');
            if (!messagesContainer) return;
            
            messagesContainer.innerHTML = agentState.chatHistory.map((msg, index) => {
                const isUser = msg.sender === 'user';
                const isLastMessage = index === agentState.chatHistory.length - 1;
                const showSuggestions = !isUser && msg.suggestions && msg.suggestions.length > 0 && isLastMessage;
                
                return `
                    <div class="agent-chat-message ${isUser ? 'user-msg' : ''}">
                        <div class="agent-msg-avatar ${isUser ? 'user' : 'agent'}">
                            ${isUser ? `
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            ` : `
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                                </svg>
                            `}
                        </div>
                        <div>
                            <div class="agent-msg-bubble">${msg.message}</div>
                            ${showSuggestions ? `
                                <div class="agent-msg-suggestions">
                                    ${msg.suggestions.map(sug => `
                                        <div class="agent-suggestion-chip" onclick="selectSuggestion('${sug.replace(/'/g, "\\'")}')">
                                            ${sug}
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function selectSuggestion(text) {
            // Set input value and trigger command
            const input = document.getElementById('agentCommandInput');
            if (input) {
                input.value = text;
                processAgentCommand(text);
                input.value = '';
            }
        }

        function showChatExpansion() {
            const expansion = document.getElementById('agentChatExpansion');
            expansion.classList.add('show');
            expansion.classList.remove('collapsed');
            agentState.isExpanded = true;
        }

        function hideChatExpansion() {
            const expansion = document.getElementById('agentChatExpansion');
            expansion.classList.add('collapsed');
            expansion.classList.remove('show');
            agentState.isExpanded = false;
        }

        function executeActionWithChat(match) {
            // Execute the action - pass original command if available
            if (match.originalCommand) {
                match.action.execute(match.originalCommand);
            } else {
                match.action.execute();
            }
            
            // Add highlight animation to newly added element
            if (match.action.confirm && match.action.confirm.includes('filter')) {
                setTimeout(() => {
                    const filterCards = document.querySelectorAll('.filter-card');
                    if (filterCards.length > 0) {
                        const lastFilter = filterCards[filterCards.length - 1];
                        lastFilter.classList.add('action-highlight');
                        setTimeout(() => lastFilter.classList.remove('action-highlight'), 600);
                    }
                }, 100);
            }
        }


        function findBestActionMatch(command) {
            let bestMatch = null;
            let highestScore = 0;

            // Search through all tab configurations
            for (const [key, tabConfig] of Object.entries(actionDatabase)) {
                // Check if command mentions this tab's keywords
                const tabMentioned = tabConfig.keywords.some(kw => command.includes(kw));
                
                // Search through all actions in this tab
                for (const [actionKey, action] of Object.entries(tabConfig.actions)) {
                    // Calculate match score based on pattern matches
                    let score = 0;
                    let matchedPattern = null;
                    
                    for (const pattern of action.patterns) {
                        if (command.includes(pattern)) {
                            // Longer patterns = better match
                            const patternScore = pattern.split(' ').length;
                            if (patternScore > score) {
                                score = patternScore;
                                matchedPattern = pattern;
                            }
                        }
                    }
                    
                    // Boost score if tab was explicitly mentioned
                    if (tabMentioned && score > 0) {
                        score += 2;
                    }
                    
                    // Update best match if this is better
                    if (score > highestScore) {
                        highestScore = score;
                        bestMatch = {
                            tab: tabConfig.tab,
                            tabConfig: tabConfig,
                            actionKey: actionKey,
                            action: action,
                            matchedPattern: matchedPattern,
                            score: score
                        };
                    }
                }
            }

            return bestMatch;
        }




        // Handle Enter key in agent input
        document.addEventListener('DOMContentLoaded', () => {
            const agentInput = document.getElementById('agentCommandInput');
            if (agentInput) {
                agentInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const command = agentInput.value.trim();
                        if (command) {
                            processAgentCommand(command);
                            agentInput.value = '';
                        }
                    }
                });
            }
        });

        // Update agent state when tabs change
        const originalSwitchTab = switchTab;
        switchTab = function(tabIndex) {
            originalSwitchTab(tabIndex);
            agentState.currentTab = tabIndex;
        };
    </script>

    <!-- Global Agentic Command Bar (Hidden on landing page) -->
    <div class="global-agent-bar" id="globalAgentBar">
        <div class="agent-command-container">
            <div class="agent-bar-icon">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                </svg>
            </div>
            <input 
                type="text" 
                class="agent-command-input" 
                id="agentCommandInput" 
                placeholder="Ask me anything... (e.g., 'Show overlap analysis' or 'Add high LTV filter')"
            >
            <div class="agent-status-indicator">
                <svg class="sparkle-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 0L14.59 8.41L23 11L14.59 13.59L12 22L9.41 13.59L1 11L9.41 8.41L12 0Z"/>
                </svg>
                Ready
            </div>
        </div>
    </div>

    <!-- Agent Chat Expansion (expands from bottom bar) -->
    <div class="agent-chat-expansion" id="agentChatExpansion">
        <div class="agent-chat-container">
            <div class="agent-chat-header-bar">
                <div class="agent-chat-header-left">
                    <div class="agent-typing-indicator" id="agentTypingIndicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                    <span style="display: none;" id="agentReadyText">AI Assistant</span>
                </div>
                <button class="agent-chat-collapse-icon" onclick="hideChatExpansion()" title="Minimize chat">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="19 9 12 2 5 9"/>
                    </svg>
                </button>
            </div>
            <div class="agent-chat-messages-container" id="agentChatMessages">
                <!-- Messages will be rendered here dynamically -->
            </div>
        </div>
    </div>

</body>
</html>
